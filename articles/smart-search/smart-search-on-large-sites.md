<!-- Filename: Smart_Search_on_large_sites / Display title: Умный поиск на крупных сайтах -->

## Индексирование сайта

Умный поиск работает путем создания и поддержания независимого индекса поисковых терминов в ряде таблиц базы данных. Проблема для больших сайтов заключается в том, что процесс индексации может быть довольно ресурсоемким по отношению к ЦП, памяти и использованию диска. Даже после первоначального построения индекса, инкрементные обновления также могут быть тяжелыми. Хорошая новость заключается в том, что запросы к индексу являются относительно быстрой и легковесной операцией.

Умный поиск подходит для большинства сайтов на Joomla. Однако поиск представляет особые трудности для крупных сайтов. Стоит помнить, что Умный поиск - это чисто PHP-реализация поисковой системы, и особенно крупным сайтам может быть лучше использовать автономную поисковую систему, такую как Solr.

Чтобы использовать Smart Search на большом сайте, вам, вероятно, понадобится настроить некоторые параметры конфигурации. Ниже приведены общие рекомендации о том, на что следует обратить внимание и что попробовать изменить.

## Всегда используйте индексатор CLI

Поскольку первоначальный процесс индексирования может занять много времени, лучше запускать индексатор из командной строки, чтобы избежать проблем, связанных с истечением времени ожидания сеансов в браузере. Индексатор CLI не прервется, независимо от того, сколько времени требуется для завершения, и его можно легко остановить, если возникнут проблемы. Кроме того, сообщения об ошибках видны при использовании индексатора CLI, тогда как они могут быть скрыты при запуске из Администратора.

Чтобы использовать интерфейс командной строки, откройте терминал, перейдите в папку cli в корне вашего сайта и введите следующую команду:

```
php joomla.php finder:index
```

## Пакетная обработка

Индексатор разбивает задачу индексирования на партии элементов контента. По умолчанию размер партии установлен на уровне 50, что означает, что до 50 элементов контента будут индексироваться за партию. Увеличение размера партии потенциально может ускорить процесс индексирования, но это потребует больше памяти и возможно больше временной дисковой памяти.

## Проблемы с нехваткой памяти

Если индексатору не хватает памяти, попробуйте сделать следующие настройки по одной до тех пор, пока проблема не будет решена.

1. Уменьшите размер партии. Если у вас особенно большие элементы контента, индексатор может исчерпать память даже на одном элементе, поэтому попробуйте сначала уменьшить его до 5, а если память все еще заканчивается, уменьшите до 1.
2. Если у вас есть возможность выделить больше памяти для индексатора, сделайте это. Вы можете увеличить память, выделенную командному индексатору, используя дополнительный параметр на командной строке. Например, чтобы увеличить лимит памяти до 256 Мб, используйте следующую команду, заменив *256M* таким объемом памяти, который вы можете безопасно выделить процессу в вашей системе.<br>
5. Попробуйте определить, какие элементы контента вызывают исчерпание памяти у индексатора. Если это не очевидно, вы можете попробовать отключить все плагины Smart Search, кроме одного. Запуск индексатора с одним включенным плагином за раз должен показать, какие типы контента вызывают проблему. В крайнем случае, подумайте о разбивке нескольких исключительно больших элементов контента на отдельные элементы. Если проблема связана с пользовательским типом контента, изучите код плагина и рассмотрите возможность индексирования меньшего объема доступного контента на один элемент.

## Проблемы с нехваткой дискового пространства

Таблицы индекса Smart Search могут быстро увеличиваться! Таблица *#__finder_links_termsX* содержит одну строку на термин/фразу для каждого элемента контента, и один статья Joomla, содержащая 1000 слов, обычно приводит к добавлению примерно 3000 строк в эти таблицы. Вторая статья аналогичного размера добавит подобное количество строк, даже если обе статьи содержат одни и те же слова. Сайт с десятками тысяч статей, некоторые из которых могут содержать тысячи слов, вероятно, в конечном итоге будет иметь эту таблицу сопоставления, содержащую миллионы строк. В таких обстоятельствах не редкость, что индексные таблицы занимают несколько гигабайт дискового пространства.

Индекс имеет возможность выбора между точностью поиска и размером индекса. Когда в глобальных настройках компонента у вас включена опция "Поиск по фразам", ваш индекс будет больше, но он также позволит получать более точные результаты поиска. Если она отключена, это означает гораздо меньший индекс, но также отсутствие возможности поиска по целым фразам.

## Заметки

1.  В настоящее время нет блокировки параллелизма, чтобы предотвратить запуск более чем одного
    процесса индексации одновременно. Это почти наверняка приведет к повреждению индекса. Даже если кто-то сохраняет изменения в элементе контента во время выполнения полной индексации, это также может потенциально повредить индекс.

*Переведено openai.com*

