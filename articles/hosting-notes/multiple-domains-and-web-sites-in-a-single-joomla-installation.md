<!-- Filename: Multiple_Domains_and_Web_Sites_in_a_single_Joomla!_installation / Display title: Несколько доменов и веб-сайтов в одной установке Joomla! -->

**Примечание:** Последнее обновление этой статьи было в 2012 году!

Хотя лучшей практикой является выделение отдельного домена и базы данных для каждого веб-сайта, могут существовать особые условия, при которых решение для мультисайта в одной установке Joomla! оправдано.

## Пример приложения

Малый бизнес, 'Johnson Candies', имеет два отдельных, но связанных между собой бренда: *Red Candy* и *Yellow Candy*. Им нужен единый сайт на базе Joomla!, где видны оба типа конфет, каждый со своей домашней страницей на сайте Joomla!, соответствующей доменам `www.redjohnsoncandy.com` и `www.yellowjohnsoncandy.com`.

Кроме того, **каждому бренду и сайту требуется собственный дизайн**: желтый шаблон для одного; красный шаблон для другого.

## Преимущества

Объединив оба бренда в одной установке Joomla!, компания Johnson Candies может сэкономить время на редактирование (требуется только один вход в систему), делиться статьями и данными между обоими брендами (или сайтами) и использовать одну функцию, такую как форма "Свяжитесь с нами", для обоих брендов.

## Процедура реализации

### Подготовка ваших доменов

Используйте один домен для вашего хостингового аккаунта, как обычно. Создайте необходимые дополнительные домены в панели управления вашего хостинга. Для целей этого руководства мы будем использовать `www.redjohnsoncandy.com` в дополнение к основному домену `www.yellowjohnsoncandy.com`.

### Установка и настройка Joomla!

Установите и настройте Joomla! как обычно. Затем создавайте статьи, меню и модули для каждого сайта.

### Создание шаблонов

Далее разработайте и установите необходимые шаблоны - по одному для каждого сайта, который вы хотите иметь. В приведенном выше примере вы создадите шаблон для *красных конфет* под именем *Красный шаблон* и шаблон для *желтых конфет* под именем *Желтый шаблон*. После установки шаблонов назначьте их соответствующим элементам меню, используя менеджер шаблонов Joomla! в Администраторской области Joomla!.

### Добавление перенаправления

#### Вариант №1: Создание перенаправления .htaccess (Apache)

**Примечание** *Сначала включите SEF URL в Joomla!*

Один из вариантов - использовать .htaccess (Apache), чтобы перенаправить запросы на данный домен на определенную страницу Joomla!.

Наша цель - перенаправить любые запросы к доменному имени `Red Candy` на заданную страницу на сайте Joomla!. В этом примере мы перенаправляем любые запросы к `www.redjohnsoncandy.com` на страницу категории-блога. Вы ранее назначили шаблон 'red candy' этому элементу меню, чтобы создать иллюзию отдельного сайта.
```apache
# Следующее правило работает, но меняет отображаемое имя домена.
RewriteCond %{HTTP_HOST} ^(www\.)?redjohnsoncandy\.com$
RewriteRule (.*) http://www.yellowjohnsoncandy.com/index.php?option=com_content&view=category&layout=blog&id=3&Itemid=12 [R=301,L]
```
Хорошо, это работает - но вы сразу же видите недостаток. Хотя пользователь успешно просматривает сайт Red Candy, он все равно будет видеть доменное имя Yellow Candy. К сожалению, если вы используете .htaccess и парковку домена (технически перенаправление), это необходимо для предотвращения создания ЦИКЛА.

#### Вариант №2: Создание перенаправления заголовка PHP

Это решение имеет такое преимущество, как поддержание иллюзии отдельных доменов/веб-сайтов для посетителя. Вместо использования .htaccess (Apache) для нашего перенаправления мы используем один из шаблонов на сайте.

В этом примере основной домен - `www.redjohnsoncandy.com`. Вы создали шаблон для этой области под названием *Red Template*. Хитрость в том, чтобы открыть файл index.php шаблона 'Red Template' и добавить следующие строки **в самом начале** основного index.php.

```php
<?php
$domain = $_SERVER["HTTP_HOST"];
$uri = $_SERVER["REQUEST_URI"];
$url = $domain . $uri;

if (($url == "redjohnsoncandy.com/") ||
   ($url == "www.redjohnsoncandy.com/")) {
   header("Status: 301 Moved Permanently");
   header("Location: http://www.redjohnsoncandy.com/index.php?option=com_content&view=category&layout=blog&id=3&Itemid=12");
}
?>
```

Вот преимущество: Теперь посетитель будет перенаправлен на соответствующую страницу *Red Site*, к которой назначен *Red Template* **только** в случае прибытия на домен 'red site'. В противном случае условное правило PHP игнорируется, и загружается сайт Yellow.

Важно помнить, что также необходимо запрашивать URI (URL, который следует за чистым доменом), чтобы вы могли делать перенаправления на тот же домен. Когда URI невиден в URL, переменная становится знаком "/". Вот почему вам нужно сравнивать свой чистый URL с знаком "/" на конце. Таким образом, вы сможете сделать 301 перенаправления на тот же домен. В противном случае вы создадите бесконечный цикл в процессе перенаправления.

#### Вариант №3: Создание перенаправления заголовка PHP для нескольких доменов с конкретными перенаправлениями доменов для пользовательских шаблонов

Решение для одного веб-пространства с разными доменами, одной установкой Joomla, в зависимости от домена, на котором приземляется пользователь, перенаправляет на другую страницу по умолчанию. Вставьте следующий PHP-код **самым первым делом** в основной файл index.php установки. Чтобы назначить другой домен, просто скопируйте и вставьте функцию "if" и отредактируйте ее значениями другого домена тем же образом. Чтобы настроить просмотры шаблонов, вам нужно будет назначить различные модули элемент/псевдонимы ссылок и настроить просмотры шаблонов в менеджере шаблонов Joomla!. Настройка псевдонима необходима при использовании настроек SEF.

```php
<?php
$domain = $_SERVER["SERVER_NAME"];
$requri = $_SERVER['REQUEST_URI'];
if (($domain == "www.example.de" && $requri == "/" ||
   $domain == "example.de"))  {
   header("Status: 301 Moved Permanently");
   header("Location: http://www.example.de/index.php?option=com_content&view=article&id=6");
}
?>
```
*Переведено openai.com*

