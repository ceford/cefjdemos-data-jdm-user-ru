<!-- Filename: How_do_UNIX_file_permissions_work%3F / Display title: Разрешения файлов в UNIX -->

Разрешения в Unix/Linux могут быть запутанными. Основные разрешения в UNIX
имеют три категории:

    Разрешения владельца: Контролируют ваш собственный доступ к файлам.
    Разрешения группы: Контролируют доступ для вас и членов вашей группы.
    Другие разрешения: Контролируют доступ для всех остальных.

В Unix, при настройке разрешений сервер позволяет вам определять
различные разрешения для каждой из этих трех категорий пользователей. В
среде веб-сервера разрешения используются для контроля того, какие владельцы веб-сайтов могут получать доступ к определенным каталогам и файлам.

## Как выглядят разрешения в Unix?

При просмотре ваших файлов через командную строку, используя команду Unix `ls -l`,
вы увидите строки, подобные следующим, по одной для каждого файла и директории:
```
drwxr-xr-x@  7 username  usergroup    224 13 Feb 10:48 includes
-rw-r--r--@  1 username  usergroup   1060 13 Apr 21:00 index.php
```
Объяснение:
* Первый символ в строке — это d для директории или - для файла, или ...
* Следующие 9 символов состоят из 3 групп по 3 символа, означающих чтение (r), запись (w) и
выполнение (x) или минус (-), означающий отсутствие доступа, для каждого из владельца, группы и других.
* Символ @ — это один из возможных расширенных атрибутов,
* Число перед именем пользователя — это глубина директории.
* Два имени — это имя пользователя владельца и название группы,
* Следующее число — это размер файла в байтах.
* Следующая дата — это время для недавних элементов или год для старых элементов.
* Последним идет имя файла или директории.

В FTP-утилитах порядок может быть другим и может быть больше или меньше информации.

### Владелец (Пользователь) относится к имени пользователя

Владелец (Пользователь) обычно вы сами, эти разрешения будут применяться
к имени вашей учетной записи хостинга.

### Группа относится к имени группы

Разрешения группы будут применяться к другим людям, которые находятся в
той же группе, что и вы; в среде хостинга, в вашей группе редко
будут другие люди. Это защищает ваши файлы и
директории от доступа других, у которых также может быть
учетная запись хостинга на том же сервере.

### Остальные относятся ко всем другим

Разрешения для других будут применяться ко всем другим на
сервере, кто не вы и не в вашей группе. Поэтому в веб-среде,
помня, что обычно никто не находится в вашей группе,
это все остальные, кроме вас, имеющие доступ к серверу. Каждое из
трех наборов разрешений определяется следующим образом:

    r = Разрешения на чтение
    w = Разрешения на запись
    x = Разрешения на выполнение

    Владелец Группа Остальные
    r w x r w x r w x

Как многие из вас уже знают, разрешения обычно выражаются
в числовом значении, например, 755 или 644. Как это связано
с тем, что мы обсуждали выше? Каждому символу в разрешениях
присвоено числовое значение, и это назначается в каждом наборе из трех, 
поэтому нам нужно использовать только три значения и повторять их для каждого набора.

    Владелец Группа Остальные
    r w x r w x r w x
    4 2 1 4 2 1 4 2 1

Теперь, когда у нас есть значение, которое представляет каждое разрешение, мы можем выразить
их в числовых терминах. Значения просто складываются в
соответствующих наборах по 3, что, в свою очередь, дает нам всего три числа,
которые сообщают нам, какие разрешения устанавливаются. Если нам сказано, что файл
имеет разрешения 777, это будет означать, что следующее верно.

    Владелец Группа Остальные
    r w x r w x r w x
    4 2 1 4 2 1 4 2 1

Таким образом...

      4+2+1 4+2+1 4+2+1
    =   7     7     7

Владелец файла будет иметь полные разрешения на чтение, запись и выполнение,
группа тоже будет иметь полные разрешения на чтение, запись и выполнение,
и любой другой пользователь сможет также читать, записывать и выполнять этот файл. 
Стандартные, сохраняемые сервером по умолчанию, разрешения для файлов и директорий обычно:

    Файлы = 644
    Директории = 755

Эти разрешения позволяют для файлов:

    644 = rw- r-- r--
    Владелец имеет разрешения на чтение и запись
    Группа имеет только чтение
    Остальные имеют только чтение

и для директорий:

    755 = rwx r-x r-x
    Владелец имеет разрешения на чтение, запись и выполнение
    Группа имеет только чтение и выполнение
    Остальные имеют только чтение и выполнение

Теперь все может усложниться, когда мы начнем говорить о
общих веб-серверах, программное обеспечение веб-сервера будет работать с
собственным именем пользователя и названием группы, большинство серверов настроены
для использования либо "apache" и "apache", либо "nobody" и "nobody" как
имя пользователя и группа. Вот проблема. Ваш веб-сервер работает как
свой собственный пользователь, и этот пользователь — это не вы и не кто-то в вашей группе,
поэтому первые два набора разрешений к нему не применяются. Только мировые 
(другие) разрешения применяются. Поэтому, если вы настроите набор разрешений, 
например 640 для файлов вашего сайта, ваш веб-сервер не сможет запустить 
файлы вашего сайта.

    640 = rw- r-- ---
    Владелец имеет разрешения на чтение и запись
    Группа имеет только чтение
    Остальные не имеют прав

Веб-серверу не назначено никаких разрешений и он не может выполнять, 
писать или, что более важно, даже читать файл для доставки его содержимого 
в браузер посетителя сайта. Если директории будут назначены разрешения 750,
это будет иметь тот же эффект, потому что веб-сервер даже не имеет 
разрешений для чтения файлов в директории, даже если файлы 
в этой директории имеют благоприятные разрешения.

    750 = rw- r-x ---
    Владелец имеет разрешения на чтение и запись
    Группа имеет разрешения на чтение и выполнение
    Остальные не имеют прав

Директории имеют одну особенность: если для директории не установлено 
разрешение на выполнение в мировом наборе (World), то, даже если установлены 
разрешения на чтение и запись, программа, которая не запускается как пользователь 
или в группе, все равно не сможет получить доступ к файлам внутри директории. 
Установка выполнения позволяет программе "выполнять" команды в директории, 
поэтому если она не включена, программа (в нашем случае веб-сервер) 
не сможет выполнить команду "чтения", и, следовательно, не сможет доставить 
ваш файл в браузер пользователя.

## Как это связано с Joomla?

Хороший вопрос. В первую очередь это важно в процессе установки через веб-инсталлятор. Если вспомнить момент, когда вы запускали веб-инсталлятор Joomla!, то вы увидите, что нам нужно было назначить определенные директории как доступные для записи. Мы нередко видим сообщения о проблемах с разрешениями во время установки или вопросы о том, какие разрешения рекомендуется устанавливать. Некоторые даже считают, что сообщение с просьбой задать разрешения на запись является слишком расплывчатым.

К сожалению, так как веб-инсталлятор не знает, как настроен ваш сервер, он не может быть более конкретным, однако, как только вы поймете настройки разрешений и узнаете немного о средах веб-сервера, вы поймете, что термин *доступный для записи* на самом деле очень конкретный и более чем адекватно описывает то, что нужно Joomla!. Если вспомнить вышеприведенную информацию, то вы вспомните, что существует три места, где можно задать разрешения на запись:

    Доступно для записи владельцу
    Доступно для записи группе
    Доступно для записи другим

Также следует помнить, что веб-сервер обычно не работает как ваш пользователь или в той же группе. Когда вы запускаете веб-инсталлятор через браузер, это веб-сервер пытается получить доступ к файлам, и, следовательно, именно разрешения для "других" применяются к нему. Если разрешения для "других" не позволяют веб-серверу читать, записывать или выполнять команды в директориях Joomla!, вы получите сообщение о том, что директории недоступны для *записи*.

В этом случае вам нужно настроить разрешения для других как "7" на директории, указанные в веб-инсталляторе. Таким образом, ваши полные разрешения могут быть 757, в худшем случае вам может понадобиться установить 777. Эти очень открытые разрешения могут быть сброшены обратно на 755 после выполнения инсталляции, чтобы повысить безопасность ваших директорий и файлов.

    757 = rwx r-x rwx
    Владельцу доступны чтение, запись и выполнение
    Группе доступны чтение и выполнение
    Другим доступны чтение, запись и выполнение

Чтобы ещё больше усложнить ситуацию, многие хостинг-компании используют программное обеспечение, такое как phpsuExec или suExec, которые меняют способ работы веб-сервера. Обычно веб-сервер не работает от вашего имени пользователя, но в данном случае он работает. Использование разрешений для *других* может не требоваться; возможно, теперь вам нужно будет только настроить директории так, чтобы они были *доступны для записи* вашему собственному имени пользователя и имени группы, что позволяет установить разрешения директорий как 755 или 775 вместо 757 или 777.

    755 = rwx r-x r-x
    Владельцу доступны чтение, запись и выполнение
    Группе доступны чтение и выполнение
    Другим доступны чтение и выполнение

    775 = rwx rwx r-x
    Владельцу доступны чтение, запись и выполнение
    Группе доступны чтение, запись и выполнение
    Другим доступны чтение и выполнение

Веб-сервер все ещё должен иметь возможность выполнения для имени пользователя и разрешения на чтение и выполнение для имени группы, чтобы он мог выполнять команду чтения файлов внутри директории. Опять же, эти разрешения могут быть понижены обратно до 755 после завершения работы веб-инсталлятора. Это основы работы с директориями, а что насчет файлов? Здесь все немного проще. Большинство файлов, которые использует Joomla!, будут довольны стандартными разрешениями 644.

    644 = rw- r-- r--
    Владельцу доступны чтение и запись
    Группе доступно только чтение
    Другим доступно только чтение

Это действительный вариант, если вам не нужно записывать файлы с веб-сервера; те же правила применяются, что и для директорий, если такая необходимость есть. Один файл, для которого вы можете захотеть задать "доступность для записи" веб-серверу, это ваш файл configuration.php. Это файл конфигурации Joomla!. Если вы планируете изменять конфигурацию через интерфейс веб-администратора, этот файл должен быть доступен для записи веб-сервером.

Если вашему серверу необходимы разрешения на запись для "других" для установки, то этот файл, возможно, также понадобится установить на 757 или 777. Однако оставление этого файла с разрешениями 757 или 777 опасно, поскольку это позволяет всем записывать в ваш файл. Многие уязвимости на веб-сайтах используют это, поэтому в целом не рекомендуется оставлять этот файл с такими разрешениями.

Если ваш веб-сервер имеет установленные инструменты SU, и вам нужно было настроить только 755 на директориях для установки, то вам, вероятно, также понадобится только установить 755 или 775 на этот файл, чтобы разрешить редактирование через интерфейс администратора, и эти разрешения в целом считаются более безопасными, чем 757 или 777.

В заключение, какие разрешения должны быть установлены для установки Joomla!? Как вы видите, это зависит!

Я знаю, что это не так полезно, как вам хотелось бы, и это, конечно, не окончательный ответ, но в общем, после установки, любые небезопасные "7" настройки могут быть сброшены на более безопасные. Например:

    Файлы = 644
    Директории = 755

Эти разрешения позволят, для файлов;

    644 = rw- r-- r--
    Владельцу доступны чтение и запись
    Группе доступно только чтение
    Другим доступно только чтение

А для директорий,

    755 = rwx r-x r-x
    Владельцу доступны чтение, запись и выполнение
    Группе доступны только чтение и выполнение
    Другим доступны только чтение и выполнение

Если у вас есть доступ к оболочке SSH, следующие команды можно запустить из командной строки, чтобы сбросить все файлы и директории обратно к серверным значениям по умолчанию 755 и 644. Перейдите в корневую директорию (" / ") вашей установки Joomla!, затем выполните:

    find . -type f -exec chmod 644 {} \;
    find . -type d -exec chmod 755 {} \;

Если у вас есть только доступ по FTP, это может быть очень трудоемкая задача, однако, если вы не изменили больше директорий во время установки, чем было запрошено, вам нужно будет сбросить только около 10 директорий и файл *configuration.php*.

Помните, что для установки любых расширений или шаблонов после фактической установки Joomla! вам, возможно, потребуется временно повысить стандартные разрешения на соответствующих директориях только на время установки, а затем вы можете снова понизить их после установки дополнения.

Если вы решите использовать *кеширование*, то каталог кеша должен быть *доступен для записи* для пользователя веб-сервера, чтобы он мог записывать свои временные файлы.

## Рекурсивно исправить разрешения

В терминале, начиная с корневого каталога сайта Joomla, используйте следующие команды, чтобы установить разрешения для файлов и папок по умолчанию для Joomla.

```bash
find . -type f -exec chmod 644 {} \;
find . -type d -exec chmod 755 {} \;
```

Примечание: команда find предполагает, что она должна начинать с текущего каталога. Для безопасности перейдите в ваш каталог public_html и укажите путь в качестве первого аргумента. В некоторых оболочках, таких как bash на Apple OS X, необходимо указать путь в команде find.

Проверьте все сторонние расширения после изменения разрешений.

