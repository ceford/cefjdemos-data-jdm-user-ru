<!-- Filename: No_original_yet / Display title: Локальный хостинг на Linux -->

## Введение

Эта статья рассказывает о размещении Joomla на личном компьютере с Linux для тестирования и разработки. Рассматриваются версии Linux из семейства Debian-Ubuntu, и в частности Linux Mint. Другие дистрибутивы похожи, но имеют разный синтаксис команд и расположение файлов.

Вам необходимо установить набор программного обеспечения, часто называемый LAMP-стеком. Эти буквы обозначают Linux, Apache, MySQL и PHP. Вы можете установить программное обеспечение, используя либо графический интерфейс пользователя (GUI), либо командную строку в окне терминала. Это разные способы использования диспетчера пакетов Synaptic.

## Установка Apache с графическим интерфейсом

Из системного меню, отмеченного логотипом LM, выберите Администрирование / Менеджер пакетов Synaptic. Вам будет предложено ввести ваш пароль. Введите ваш пароль для входа, чтобы открыть графический интерфейс. В правом верхнем углу находится кнопка `Поиск`. Выберите её и введите **apache**, затем выберите `Искать`. Поставьте галочку напротив `apache2`, и в появившемся окне выберите `Отметить для установки`. Появится другое окно с перечнем дополнительных пакетов, необходимых для поддержки Apache. Выберите `Отметить`:

![менеджер пакетов synaptic](../../../en/images/hosting/synaptic-package-manager-gui.png "Графический интерфейс менеджера пакетов Synaptic")

Выберите кнопку `Применить` в верхней панели инструментов и кнопку `Применить` в диалоговом окне с итогами. Apache будет установлен и настроен, процесс завершится **диалоговым окном Примененные изменения**. Выберите `Закрыть`.

Вы можете подтвердить, что Apache установлен и работает, открыв ваш браузер, по умолчанию это Firefox в новой установке Linux Mint, и введя **localhost** в строку URL. Вы должны увидеть страницу по умолчанию Apache2 Ubuntu:

![страница apache по умолчанию](../../../en/images/hosting/apache-default-page.png "Страница Apache по умолчанию")

Страница содержит полезную информацию о местоположении файлов, которая может быть не так легко доступна позже, поэтому вы можете захотеть распечатать эту страницу на бумаге или сохранить в pdf файл.


## Установка PHP через интерфейс командной строки

Наиболее целесообразно установить PHP через командную строку. Одна из причин этого заключается в том, что, на момент написания, Synaptic Package Manager предлагает только PHP8.1, хотя PHP8.2 уже доступен некоторое время и может быть установлен из репозитория третьей стороны. В этом учебном руководстве имеется хорошее описание процедуры с разделами Быстрый старт и Детальный.

Сначала закройте графический интерфейс Synaptic Package Manager, затем откройте окно Терминала и введите следующие команды по одной:

```bash
sudo add-apt-repository ppa:ondrej/php
sudo apt update
sudo apt install php8.2 php8.2-cli php8.2-{bz2,curl,mbstring,intl}
sudo apt install php8.2-fpm
sudo a2enconf php8.2-fpm
sudo systemctl reload apache2
```
Проверьте в вашем браузере, что страница по умолчанию на localhost все еще работает.

## Установка MySQL или MariaDB

Вы можете искать информацию об этих пакетах баз данных в интернете. MySQL — это традиционный выбор, но позже он был приобретен Oracle и теперь менее популярен. MariaDB является полным Open Source заменителем с дополнительными функциями. Обе системы работают с Joomla! 5, но менять одну на другую непросто. Таблицы нужно экспортировать и импортировать. Joomla! 5 требует конкретные минимальные версии, которые предлагает Linux Mint через менеджер пакетов Synaptic.

Откройте графический интерфейс менеджера пакетов Synaptic и найдите либо mysql-server, либо mariadb-server. Выберите флажок для элемента, заканчивающегося на -server. Выберите `Отметить для установки`, а затем `Применить` в верхней панели инструментов. Вы можете открыть панель «Детали», чтобы увидеть, что происходит во время установки. Выберите `Закрыть`, когда закончите.

Вы можете проверить, работает ли ваша база данных, введя `mysql` в командной строке. Это одинаково как для MySQL, так и для MariaDB. Вы должны увидеть сообщение об ошибке `Доступ запрещен`, что нормально, так как это указывает на то, что ваша установка базы данных действительно работает.

## Установка phpMyAdmin

phpMyAdmin — это инструмент управления базами данных с графическим интерфейсом, который вам понадобится для создания и управления вашими базами данных. В графическом интерфейсе Synaptic Package Manager найдите **phpmyadmin**. Установите флажок и выберите `Mark for Installation` (Отметить для установки). После загрузки появится запрос для автоматической перенастройки веб-сервера. Установите флажок для `apache2`, затем нажмите кнопку `Next` (Далее). На следующем экране конфигурации оставьте флажок `Configure database...` (Настроить базу данных...) установленным и выберите `Next` (Далее).

Выберите пароль для приложения для пользователя phpmyadmin. Тест: введите в адресной строке вашего браузера localhost/phpmyadmin. Вы должны увидеть экран входа в phpMyAdmin. С именем пользователя phpmyadmin и паролем, который вы ввели во время установки, вы сможете войти. Но вы не сможете создавать базы данных! Чтобы решить проблему, вам нужно отредактировать файл конфигурации с правами суперпользователя в окне Терминала:

```bash
sudo nano /etc/phpmyadmin/config.inc.php
```

Найдите две строки, содержащие // $cfg['Servers'][$i]['AllowNoPassword'] = TRUE; и удалите начальные двойные слэши, чтобы раскомментировать их. Обе строки!

Затем войдите в MySQL из командной строки и создайте нового пользователя, предоставив ему все привилегии:
```bash
sudo mysql
CREATE USER 'admin'@'localhost' IDENTIFIED BY '';
GRANT ALL PRIVILEGES ON *.* TO 'admin'@'localhost' WITH GRANT OPTION;
exit
```

Затем вернитесь в phpMyAdmin и попробуйте войти с именем пользователя **admin** и без пароля. Вы должны увидеть все базы данных и сможете создавать новые базы данных.

## Приоритет индексного файла

По умолчанию страницы веб-сайта на Ubuntu/Linux Mint находятся в каталоге /var/www/html. Если вы выведите содержимое этого каталога, вы увидите, что он содержит файл index.html с содержимым стандартной страницы Ubuntu Apache2. Создайте файл с именем index.php в этом каталоге со следующим содержимым:

```php
<?php echo phpinfo();
```
Перезагрузите localhost. Изменений нет! Введите **localhost/index.php** в адресную строку, и вы увидите страницу с информацией о версии PHP. Это поведение контролируется конфигурацией Apache по умолчанию, и его можно изменить, включив модуль `dir` Apache и отредактировав его конфигурацию:

```bash
sudo a2enmod dir
sudo nano /etc/apache2/mods-enabled/dir.conf
```

Переместите index.php в начало списка. Затем перезапустите Apache:

```bash
sudo systemctl restart apache2
```

Теперь, при использовании одного только **localhost** в адресной строке, вы должны увидеть содержимое файла index.php, страницу с информацией о PHP.

## Виртуальные хосты

В стандартной установке Linux системные файлы находятся в корневой папке (/), а пользовательские данные — в домашней папке (/home/myusername). Это может быть проблемой, так как у пользователя Apache по умолчанию, www-data, может не быть соответствующих разрешений для создания файлов в пользовательском пространстве. Наилучшим решением является создание виртуальных хостов.

Сначала нужен модуль, который позволит Apache переключать пользователя и группу в соответствии с каждым пользователем:

```bash
sudo apt-get install libapache2-mpm-itk
sudo a2enmod mpm_itk
```

Затем сделайте копию файла конфигурации сайта по умолчанию и отредактируйте его:

```bash
cd /etc/apache2/sites-available
sudo cp 000-default.conf username.localhost.conf
sudo nano username.localhost.conf
```

Файл конфигурации сайта по умолчанию содержит комментарии для объяснения его содержимого. Они опущены в иллюстрации ниже. Раскомментируйте строку ServerName и измените все экземпляры `username` на ваше собственное имя пользователя.

```xml
<VirtualHost *:80>
        ServerName username.localhost
        ServerAdmin webmaster@localhost
        DocumentRoot /home/username/public_html
        <IfModule mpm_itk_module>
                AssignUserId username username
        </IfModule>
        <Directory /home/username/public_html/ >
                Options Indexes FollowSymLinks
                AllowOverride None
                Require all granted
        </Directory>
        ErrorLog ${APACHE_LOG_DIR}/error.log
        CustomLog ${APACHE_LOG_DIR}/access.log combined
</VirtualHost>
```

Активируйте новый сайт и перезагрузите Apache:

```bash
sudo a2ensite username.localhost
sudo systemctl reload apache
```

Сделайте запись в файле /etc/hosts, чтобы добавить запись для нового виртуального хоста. В противном случае ваш браузер будет искать его в интернете.

```bash
sudo nano /etc/hosts
```
Когда закончите, это будет выглядеть примерно так:

```bash
127.0.0.1       localhost
127.0.0.1       username.localhost
127.0.1.1       hostname

# Следующие строки желательны для хостов, поддерживающих IPv6
::1     ip6-localhost ip6-loopback
fe00::0 ip6-localnet
ff00::0 ip6-mcastprefix
ff02::1 ip6-allnodes
ff02::2 ip6-allrouters
```
**Имя хоста:** Это имя, которое вы дали своему компьютеру при установке Linux. Оно вам скоро понадобится. Вы можете изменить его, если хотите, но лучше сначала прочитайте об этом.

Если все хорошо, по адресу вида username.localhost вы увидите список файлов вашего каталога public_html. Публичное отображение списков файлов считается плохой практикой, угрозой безопасности и обычно запрещается другой настройкой Apache. Однако для личного сайта на личном компьютере, используемом для разработки и тестирования, это очень полезно. Можно настроить много разных сайтов в разных подкаталогах. Например, сайты Joomla 4 и Joomla 5, форумы, вики и так далее. Когда у вас много тестовых сайтов, бывает трудно запомнить все названия подкаталогов!

## Доступ к Домашней Сети

Если у вас есть другой компьютер в домашней сети, вероятно, вы захотите получить доступ к вашему Linux-сайту и с него. Чтобы это работало, вам нужен еще один виртуальный хост. Скопируйте и отредактируйте только что созданный:

```bash
cd /etc/apache2/sites-available
sudo cp username.localhost.conf username.conf
sudo nano username.conf
```
Измените ServerName с username.localhost на username.hostname, а затем активируйте новый виртуальный сайт и перезапустите Apache.

```bash
sudo a2ensite username
sudo apachectl restart
```
Перейдите на другой компьютер в домашней сети и отредактируйте его личный файл hosts. Например, на Mac отредактируйте /private/etc/hosts и добавьте следующую строку внизу:

```bash
192.168.178.20 username.hostname www.username.hostname
```
Где 192.168.178.20 — это IP-адрес вашего Linux-компьютера.

Теперь на втором компьютере вы сможете получить доступ к веб-серверу на вашем Linux-компьютере, введя username.hostname в адресной строке вашего браузера.

## Заметки о разделах

Программное обеспечение, установленное с помощью Synaptic Package Manager, обычно находится в корневом каталоге Linux (/). Данные пользователей расположены в домашнем каталоге (/home). В простой установке эти каталоги находятся в одном физическом разделе диска.

В более сложной установке, возможно, с возможностью загрузки различных операционных систем (Windows или Linux) или разных версий одной и той же операционной системы, корневой каталог и данные пользователей часто находятся в отдельных разделах. Это позволяет иметь доступ к одним и тем же данным пользователей из каждой операционной системы.

Однако есть загвоздка: сайт Joomla, расположенный в каталоге /home/username, нуждается в данных базы данных, которые обычно находятся в корневом каталоге, а именно в /var/lib/mysql. Вы можете переместить каталог данных MySQL/MariaDB в место, доступное для обеих операционных систем, либо в раздел /home, либо в отдельный раздел. Этот учебник описывает, как изменить каталог данных MySQL в Ubuntu и Debian Linux. Это должно быть сделано для каждой операционной системы, но здесь не рассматривается.

*Переведено openai.com*

