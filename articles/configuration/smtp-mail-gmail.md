<!-- Filename: How_to_debug_SMTP_mail_in_Joomla_4 / Display title: SMTP почта и Gmail -->

## Введение

На странице глобальной конфигурации, в панели сервера, есть возможность выбрать почтовый агент доставки. Настройка по умолчанию - *PHP Mail*. Если это не работает, вам могут порекомендовать использовать SMTP. Это использует тот же механизм, что и ваше почтовое приложение. Существует несколько настроек, которые необходимо правильно установить. Кратко:

Перейдите в **глобальную конфигурацию** и выберите вкладку **сервер**. Найдите панель *Почта* в нижней части формы.

- **Почтовый агент** установите на SMTP. Появится несколько дополнительных полей.
- **SMTP Host** По умолчанию это localhost, но это вряд ли будет работать. Его необходимо настроить на хост, который обрабатывает вашу исходящую почту, например, аккаунт Gmail.
- **SMTP Port** По умолчанию 25. Убедитесь, что это значение ожидает ваш SMTP-хост.
- **SMTP Security** По умолчанию *Нет защит*, но вам, вероятно, понадобится STARTTLS.
- **SMTP Authentication** Это может не потребоваться, если вы используете домашнюю сеть, которая ожидает, что исходящие электронные письма не должны требовать аутентификации. В противном случае:
- **Имя пользователя SMTP** и **пароль SMTP** введите значения, которые вы используете для доступа к вашему аккаунту электронной почты через интернет.
- Выберите кнопку **Отправить тестовое письмо**.

## Использование Gmail

Если у вас есть работающая учетная запись Gmail, вы можете использовать Gmail в качестве почтового сервера, настроив его в глобальной конфигурации.

На вкладке сервера установите следующие параметры:

- Почтовый агент: SMTP
- SMTP Host: smtp.gmail.com
- SMTP Port: 465
- Безопасность SMTP: SSL/TLS
- Аутентификация SMTP: Да
- Установите следующие две строки с вашей информацией. Вам нужно использовать пароль приложения (ASP), описанный ниже.
- Имя пользователя SMTP: ваше имя пользователя Gmail
- Пароль SMTP: пароль приложения (ASP), который вы создали, описан ниже.

Следующие сочетания также работают:

- SMTP Port: 587
- Безопасность SMTP: STARTTLS
- SMTP Port: 25
- Безопасность SMTP: STARTTLS

Модуль SSL не нужно включать в Apache.

Расширение OpenSSL необходимо включить в PHP. Подробности можно найти на [странице установки php.net](https://www.php.net/manual/en/openssl.installation.php).

Если вы используете WAMP на Windows, модуль openssl не включен по умолчанию, и вам нужно его включить. Чтобы сделать это:

1. Откройте файл php.ini и раскомментируйте строку `extension=php_openssl.dll`, удалив точку с запятой ; в начале строки.
2. Сохраните файл php.ini и перезапустите службу Apache.

Обратите внимание, что если вы используете двухэтапную аутентификацию в Gmail, вам нужно добавить новый пароль в Настройки - Учетные записи - Изменить настройки учетных записей - Другие настройки учетной записи Google - Безопасность - Двухэтапная аутентификация - Управление паролями приложений.

Когда новый Пароль Приложения (ASP) представлен группами по четыре символа, разделенных пробелами, убедитесь, что вы **не вводите пробелы** в пароль SMTP в настройках почтового сервера в Joomla.

- Пароли Приложений (ASP): Cм. страницу поддержки Google под названием [Вход с использованием паролей приложений](https://support.google.com/accounts/answer/185833).
- Двухэтапная аутентификация: Cм. страницу поддержки Google под названием [Включение двухэтапной аутентификации](https://support.google.com/accounts/answer/185839).

## Отладка

Если письмо не отправляется или никогда не приходит:

- Выберите **Плагины** на панели **Домашняя панель → Сайт**.
- Найдите и включите плагин **System - Debug** и настройте его:
- Установите **Разрешенные группы** на *Супер пользователи*, чтобы ограничить вывод отладки вашей собственной сессией входа как на бэкенде, так и на фронтенде. Если вы не хотите входить на фронтенд как Супер пользователь, создайте уникальную группу пользователей для ваших тестовых действий и выберите эту группу из списка разрешенных групп пользователей.
- **Сохранить и закрыть**
- Выберите **Глобальная конфигурация** на панели **Домашняя панель → Сайт**.
- Во вкладке *Система* установите **Отладка системы** на *Да*.
- Во вкладке *Сервер* установите **Отчет об ошибках** на *Максимум*.
- Во вкладке *Логирование* обратите внимание на содержимое *Путь к папке логов*, обычно *\[что-то\]/administrator/logs*. 
- Установите **Логировать почти все** на *Да*.
- В панели *Собственное логирование* установите поле *Категории логирования* на *mail* (без кавычек).
- **Сохранить**, чтобы сохранить настройки отладки.
- На вкладке **Сервер** выберите кнопку *Отправить тестовый email* в нижней части страницы.

Если во время тестирования возникнут проблемы в коде, вы получите *Трассировку стека*, которая поможет вам или другим диагностировать проблему. Также обратите внимание на файл в папке логов с именем, похожим на *administrator/logs/everything.php*, и откройте его с помощью текстового редактора. Это может помочь увидеть, что было записано в логах, когда отправлялось сообщение.

*Переведено с помощью openai.com*

