<!-- Filename: J4.x:Multi-factor_Authentication / Display title: Многофакторная аутентификация -->

## Введение

Система многофакторной аутентификации Joomla! основана на Akeeba Loginguard, и большая часть этой документации была создана с разрешения Akeeba.

## Что это делает?

Добавляет множество необязательных методов двухэтапной верификации для входа в Joomla!. После входа только с использованием имени пользователя и пароля вас попросят предоставить вторую ступень верификации, например, код, сгенерированный Google Authenticator. Пока вы не предоставите правильную вторую ступень верификации, вы не сможете получить доступ ни к одной из страниц на сайте. Вы всегда будете перенаправлены на страницу "проверки входа". Это похоже на то, что делает Google, когда вы пытаетесь войти в GMail.

Это отличается от оригинального метода двухфакторной аутентификации Joomla!, который требовал ввода второго фактора аутентификации (например, код, сгенерированный Google Authenticator) вместе с именем пользователя и паролем.

Преимущества двухэтапной верификации:

- Менее запутанно для пользователя. Больше нет необходимости в поле "секретный ключ", которое вводило пользователей в заблуждение.
- Может работать с методами входа без пароля, такими как социальный вход (например, Facebook), безопасные аппаратные токены, SSO (единый вход) и т.д. Уточнение: двухэтапная верификация может быть настроена на запрос после того, как пользователь войдет с помощью метода входа без пароля. Она не реализует методы входа без использования пароля.
- Улучшенный контроль доступа. Вы можете установить параметры пользователя, чтобы требовать или отключать многофакторную аутентификацию по группам пользователей.
- Позволяет использовать альтернативные методы аутентификации в одном аккаунте. Вы можете иметь несколько методов аутентификации в своем аккаунте. Например, можно настроить приложение Google Authenticator и YubiKey.
- Поддерживает методы, которые не требуют ввода кода. Например, ключи FIDO2, биометрическая верификация и т. д. Эти методы требуют взаимодействия с браузером и/или операционной системой через нативные API HTML5.
- Поддерживает методы, которые требуют взаимодействия с пользователем. Например, отправка кода через push-сообщение, SMS или электронную почту. Эти методы требуют знания о пользователе, который проходит аутентификацию, перед отправкой кода аутентификации пользователю.
- Бесплатно. В отличие от сторонних сервисов, предоставляющих многофакторную аутентификацию, вам не нужно платить за начальную настройку или ежемесячную / ежегодную плату за обслуживание для каждого сайта или пользователя, использующего двухэтапную верификацию. Программное обеспечение предоставляется бесплатно.

## Как это работает

Вы входите на свой сайт обычным способом, например, вводя имя пользователя и пароль. Важно отметить, что на этом этапе вам не нужно вводить данные для двухфакторной аутентификации.

Система обнаруживает, что вы сейчас вошли в систему, но не выполнили двухфакторную аутентификацию. Она сохраняет URL, который вы должны были увидеть, и немедленно перенаправляет вас на страницу входа в систему. Любая попытка перейти на другую страницу приведет к появлению страницы авторизации.

Модули на вашем сайте могут содержать конфиденциальную информацию. Для обеспечения конфиденциальности модули принудительно деактивируются при рендеринге. Это означает, что ни одна позиция модуля не будет отображена на странице. Помните об этом, если вы заметите, что заголовок или другие ключевые элементы дизайна вашего сайта отсутствуют на странице авторизации.

Обратите внимание, что плагины при этом НЕ отключаются. Это происходит потому, что Joomla делает чрезвычайно сложным удаление отдельных плагинов после их загрузки, и потому что большинство плагинов выполняют критически важную функциональность на вашем сайте.

После предоставления данных для двухфакторной аутентификации в пользовательской сессии устанавливается флаг, указывающий, что вы полностью авторизованы для использования сайта. Более того, вы будете перенаправлены на URL, который она сохранила сразу после вашего первоначального входа.

## Двухфакторная аутентификация против входа с использованием WebAuthn

Вход с использованием WebAuthn является наиболее безопасным вариантом. Вы указываете только имя пользователя, которое считается общедоступной, незащищенной информацией. Сайт создает криптографическую задачу, которая подписывается браузером с использованием защищенного оборудования — внешнего защищенного аппаратного токена или модуля TPM / Secure Enclave вашего устройства — и возвращается на сервер. Сервер проверяет подпись. Эта проверка использует криптографию с открытым ключом, при этом на сайте хранится только открытый ключ. Это делает вход практически невосприимчивым к фишингу и крайне безопасным. Если вы используете это, вам не нужен второй фактор аутентификации — но если вы действительно хотите, вы можете использовать WebAuthn и для него.

Без использования каких-либо федеративных методов входа (например, вход с использованием вашей учетной записи в социальной сети, службы единого входа, LDAP-сервера и т. д.) традиционный вход с использованием имени пользователя и пароля не так безопасен, как вход с использованием WebAuthn. Ввод имени пользователя и пароля может быть перехвачен, украден или угадан. Это делает доверие только одному имени пользователя и паролю очень проблематичным.

Для многофакторной аутентификации вы указываете только свое имя пользователя и пароль. Успешная фишинговая атака получит только этот первый фактор аутентификации, но не ваш второй фактор аутентификации. После успешного входа вы попадаете на удерживающую страницу. Вы не можете ничего делать на сайте, пока не укажете свой второй фактор. Поскольку ввод второго фактора отображается на отдельной странице, он может быть интерактивным (например, WebAuthn), асинхронным (например, получение OTP по электронной почте, SMS или push-уведомлению) или инициируемым пользователем (например, TOTP или OTP Yubikey). Еще лучше, пользователь может включить несколько методов второго фактора в своей учетной записи, чтобы предотвратить случайную блокировку доступа к сайту. Например, вы можете использовать WebAuthn с внешним защищенным аппаратным донглом в качестве вашего основного, самого безопасного второго фактора. Также можно настроить обычный TOTP на случай, если вы потеряете донгл или забудете взять его с собой. Некоторые методы второго фактора позволяют использовать несколько экземпляров, например, вы можете иметь несколько аутентификаторов WebAuthn, чтобы использовать встроенный аутентификатор на вашем компьютере с Windows, iPhone и планшете Android, не запоминая брать с собой аппаратный донгл и адаптеры каждый раз, когда вы покидаете рабочее место.

Давайте подведем итоги. От наиболее безопасного до наименее безопасного ваши варианты:

- WebAuthn в качестве основного метода входа с дополнительной многофакторной аутентификацией.
- WebAuthn в качестве единственного метода входа.
- Имя пользователя и пароль в качестве основного метода входа с дополнительной многофакторной аутентификацией.
- Только имя пользователя и пароль в качестве единственного метода входа.

## Плагины

Каждый из факторов многофакторной аутентификации реализуется через плагины. Их можно включать или отключать по мере необходимости, а также добавлять новые, когда появляются новые методы. Плагины, поставляемые с ядром Joomla, включают:

- **Код подтверждения**: шестизначные коды подтверждения, создаваемые приложением-аутентификатором (Google Authenticator, Authy, LastPass Authenticator и т. д.), менеджером паролей (1Password, BitWarden, Keeper, KeePassXC, Strongbox и т. д.) или, в некоторых случаях, их браузером.
- **YubiKey**: позволяет пользователям на вашем сайте использовать многофакторную аутентификацию с использованием защищенного аппаратного токена YubiKey. Пользователям необходимы собственные устройства YubiKey, доступные на сайте www.yubico.com.
- **Веб-аутентификация**: поддерживается всеми современными браузерами. Большинство браузеров предлагают аутентификацию, специфичную для устройства, защищенную паролем и/или биометрией (датчик отпечатков пальцев, сканирование лица и т. д.).
- **Аутентификационный код по электронной почте**: использование ограниченных по времени, шестизначных кодов безопасности, отправленных вам по электронной почте. Настройка по умолчанию составляет 2 минуты.
- **Фиксированный код**: предназначен для тестирования и иллюстрации, и по умолчанию отключен. Он не должен быть включен на рабочем сайте.

Обратите внимание, что существует отдельный плагин **Система - WebAuthn вход без пароля** для обработки входа с помощью кнопки веб-аутентификации в форме входа.

## Параметры пользователей

Форма «Параметры пользователей» содержит форму многофакторной аутентификации для настройки работы многофакторной аутентификации в Joomla. Нажмите кнопку «Переключить встроенную справку» для получения информации о каждом параметре.

![форма многофакторной аутентификации параметров пользователей](../../../en/images/users/users-configuration-mfa.png)

## Профиль пользователя

Форма «Администратор / Пользователи: Редактировать профиль» имеет отдельные вкладки для WebAuthn Вход и Многофакторная аутентификация, однако последняя видна только владельцу учетной записи. Даже суперпользователи не видят эту вкладку для других пользователей.

Форма «Сайт / Редактировать ваш профиль» имеет вкладки на серверной стороне, расположенные одна над другой, что может быть сбивающим с толку, поскольку Веб-аутентификация появляется дважды: сначала для входа без пароля, а затем для многофакторной аутентификации. На следующей иллюстрации показана часть формы Многофакторной аутентификации после создания метода. Это автоматически устанавливает функцию в состояние Включено и показывает опцию для создания резервных кодов.

![вид сайта формы многофакторной аутентификации пользователя](../../../en/images/users/multi-factor-authentication-site-profile.jpg)

Как упомянуто выше, вы можете попробовать каждую, выбрав кнопку + Добавить ..., но выберите «Отмена» в следующей форме, если решите не продолжать.

*Переведено с помощью openai.com*

