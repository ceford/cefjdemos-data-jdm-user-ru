<!-- Filename: WebAuthn_Passwordless_Login / Display title: Вход с помощью WebAuthn  -->

## Вход без пароля с помощью WebAuthn

Веб-аутентификация, или WebAuthn, позволяет пользователю безопасно войти на сайт без использования пароля — хотя имя пользователя все еще требуется. Она использует сильную криптографию, устойчивую к наиболее распространенным проблемам, связанным с паролями:
* кто-то угадал его (атака методом перебора)
* кто-то перехватил его (атака посредника)
* кто-то обманом заставил вас его раскрыть (фишинговая атака)
* кто-то взломал его после получения копии вашей базы данных (атака с использованием SQL-инъекции)
* кто-то его украл.

WebAuthn не только очень безопасен, но и очень удобен в использовании! Вам больше не нужно запоминать длинные пароли или использовать менеджер паролей. Все, что вам нужно, это *аутентификатор*, иногда его также называют *ключом доступа*.

Аутентификатор может иметь множество форм, физических или виртуальных. Это может быть отдельный аппаратный ключ, подключаемый к вашему устройству через USB, Bluetooth или NFC. Это может быть ваше устройство, разблокирующее встроенный аутентификатор с помощью PIN-кода, считывателя отпечатков пальцев, сканирования лица или аналогичной биометрической проверки.

Эта функция уже работает на устройствах под управлением Android и iOS/iPadOS, и мы также работаем над ее активацией в Windows. Она может быть даже вашим телефоном — в настоящее время это возможно с телефонами на Android, но эта функция также появится на устройствах с iOS/iPadOS.

WebAuthn работает только через HTTPS и только тогда, когда ваш сайт использует действительный, доверенный сертификат. Не волнуйтесь, вам не нужно тратить дополнительные деньги; бесплатные услуги, такие как Let's Encrypt, обычно интегрируются в панели управления веб-хостингом и работают отлично с WebAuthn.

WebAuthn использует криптографию с открытым ключом, ту же проверенную технологию, которая защищает ваши сайты с помощью HTTPS, защищает вашу банковскую информацию и так далее. Приватный ключ никогда не покидает аутентификатор. Ваш сайт хранит только открытый ключ. Даже если вы пострадаете от утечки данных, злоумышленник останется с практически бесполезным открытым ключом; ему потребуется тысячи до миллионов лет использования процессора, чтобы взломать его, в отличие от нескольких минут или часов, необходимых для взлома хэша фиксированного пароля, который вам нужно запомнить.

WebAuthn — это будущее аутентификации. Легкий, безопасный и без забот. Все, чем фиксированные пароли не являются.

Следующее изображение показывает аппаратное устройство, вставленное в USB-порт ноутбука. Оно стоило £15 в феврале 2022 года.

![фотография аппаратного устройства](../../../en/images/users/passwordless-login-hardware-device.jpg)

WebAuthn использует системный плагин, который включен по умолчанию. Кнопка **Веб-аутентификация** будет присутствовать на экранах входа по умолчанию в Joomla 4 и более поздних версиях, как показано на экране входа администратора:

![безопасная форма входа администратора](../../../en/images/users/passwordless-login-login-form.jpg)

## Конфигурация пользователя

Пользователь должен сначала зарегистрироваться с обычным именем пользователя и паролем. После входа в систему перейдите к форме профиля пользователя. Для администратора:

- Выберите **Меню пользователя → Редактировать аккаунт → Аутентификация в интернете W3C (WebAuthn) Вход**, чтобы открыть форму, изначально без зарегистрированных аутентификаторов.
- Выберите **Добавить новый аутентификатор**.

Точное представление следующего шага зависит от вашего браузера. Обычно вы видите предупреждение, сообщение или окно с просьбой выбрать тип аутентификатора или, если вы используете аппаратный аутентификатор, подключенный к вашему устройству, напоминание о нажатии кнопки на аппаратном аутентификаторе. По соображениям безопасности и удобства для активации аутентификатора отводится относительно короткий интервал времени: 60 секунд.

![secure administrator login hardware prompt](../../../en/images/users/passwordless-login-hardware-propmpt.png)

После того как вы разблокируете аутентификатор — нажав кнопку, сканируя отпечаток пальца/лицо, введя PIN-код или комбинацию методов в зависимости от вашего аутентификатора — сообщение исчезает, а аутентификатор регистрируется, и экран выглядит следующим образом:

![secure administrator login registered authenticator](../../../en/images/users/passwordless-login-registered-authenticator.png)

Очень важно заметить, что вы можете регистрировать или удалять аутентификаторы только в своем собственном аккаунте пользователя. По соображениям безопасности даже суперпользователю запрещено регистрировать, редактировать или добавлять аутентификаторы в других учетных записях пользователей.

### Аутентификаторы

Вы можете использовать любой аутентификатор FIDO U2F или FIDO2. FIDO U2F — это более старый стандарт, который поддерживает более ограниченный, менее безопасный набор криптографических методов. FIDO2 — это более новый стандарт, который поддерживает гораздо более безопасные криптографические методы, включая криптографию эллиптических кривых, метод, который, как считается, устойчив даже к квантовым вычислениям (если и когда это станет практической реальностью). Более того, аутентификаторы FIDO2 могут быть настроены на дополнительные защиты, такие как PIN-код или биометрический контроль (например, скан отпечатка пальца), что означает, что даже если вы потеряете физическое владение самим аутентификатором, тот, кто его найдет, не сможет войти на ваши сайты.

Если вы хотите купить аппаратный аутентификатор, вы можете искать "FIDO2" на вашем любимом рынке, например, Amazon. Выбор достаточно широк.

Вы также можете использовать программный FIDO-ключ, такой как Krypton, в качестве вашего аутентификатора.

Многие устройства имеют встроенную аутентификацию, совместимую с FIDO2:

- Windows 10 и 11 имеют Windows Hello с PIN-кодом, сканером отпечатков пальцев, камерой распознавания лица или комбинацией аппаратного ключа и PIN-кода. Поддержка Windows Hello добавляется в плагины с целью релиза Joomla 4.2.0.
- macOS имеет TouchID на всех портативных компьютерах с чипсетом T2 или на тех, которые основаны на Apple Silicon с использованием встроенного сенсора TouchID, а также на всех настольных компьютерах на базе Apple Silicon с новым алюминиевым клавиатурой Apple с сенсором отпечатков пальцев.
- iOS / iPadOS имеет TouchID на всех устройствах со сканером отпечатков пальцев и FaceID на всех новых устройствах с инфракрасной точечной камерой FaceID.
- Некоторые устройства Android оснащены сканером отпечатков пальцев или камерой распознавания лица. Они также могут работать как аутентификаторы FIDO2 на Android 9 или позже, используя как минимум Google Chrome.
- Другие устройства также могут быть доступны. Например, смартфоны Android, использующие ![caBLE](https://groups.google.com/a/fidoalliance.org/g/fido-dev/c/go6GoFW27Dw/m/9flCLR5pBQAJ?pli=1)

### Браузеры, совместимые с WebAuthn

Браузеры на основе Chromium и Firefox поддерживают WebAuthn с начала 2019 года.

Safari и все браузеры iOS/iPadOS (которые, фактически, являются Safari с другим интерфейсом) полностью поддерживают WebAuthn с версии iOS/iPadOS 13, выпущенной в конце 2019 года.

Практически говоря, если ваша операционная система и браузер были выпущены после середины 2020 года, у вас не должно быть никаких проблем. Только некоторые очень редкие браузеры все еще не поддерживают WebAuthn.

## Аутентификация

Чтобы войти в систему, вы должны ввести свое имя пользователя в поле Имя пользователя формы входа. Вам не нужно вводить пароль, но если ваш браузер автоматически заполняет его, просто оставьте его. Пароль НЕ отправляется на сервер, когда форма отправляется через кнопку Веб-аутентификации.

Отсюда следует, что вы можете войти в систему, используя либо Имя пользователя и Пароль, либо Имя пользователя и Веб-аутентификацию.

## Как отключить плагин

Если вы не хотите разрешать WebAuthn, просто перейдите к списку плагинов и найдите в группе System плагин "System - WebAuthn Passwordless Login" и отключите его. Настраивать параметры не требуется.

## Требования к серверу

Для работы WebAuthn должны быть выполнены следующие условия:

- HTTPS с действительным, подписанным сертификатом. Большинство хостингов позволяют использовать бесплатные сертификаты, выданные Let's Encrypt. Они отлично работают с WebAuthn.
- Расширение OpenSSL для PHP должно быть установлено и включено.
- Расширение PHP GMP или расширение PHP BCmath должно быть установлено и включено (достаточно любого из них).
- Библиотека Sodium, по возможности, должна быть включена; она позволяет использовать Эллиптическую криптографию для совместимых аутентификаторов FIDO2, которая, как мы уже сказали, является самым безопасным криптографическим методом.

## Часто задаваемые вопросы и устранение неполадок

### Я не вижу кнопку входа "Web Authentication"

Вы обращаетесь к вашему сайту не через HTTPS. WebAuthn доступен только для сайтов HTTPS с действительным сертификатом. Это мера предосторожности, встроенная в стандарт WebAuthn. Плагин проверяет, осуществляется ли доступ к сайту через HTTPS, используя класс Uri в Joomla. В редких случаях, когда сервер искажает информацию о протоколе, вы можете не увидеть кнопку, даже если ваш сайт (утверждается) является HTTPS. То же самое происходит, если вы изменили файл configuration.php и настроили необязательный параметр \$live_site с префиксом http:// вместо https://.

Также обратите внимание, что сторонние модули и компоненты аутентификации, реализующие собственную форму входа, могут еще не отображать эти кнопки. Мы добавили новую инфраструктуру для их поддержки, подобно тому, что мы сделали в Joomla! 3.2, чтобы поддержать двухфакторную аутентификацию.

### Мне все равно нужно указывать имя пользователя. Разве WebAuthn не должен избавлять от использования имен пользователей?

На самом деле нет. Текущая спецификация WebAuthn не предоставляет управление идентификацией. Веб-браузеры требуют от нас отправки списка допустимых публичных ключей WebAuthn на этапе входа. Это означает, что нам нужно ваше имя пользователя, чтобы его получить.

Тем не менее, использование WebAuthn наконец-то ясно показывает, что имена пользователей *не должны считаться секретом*. Они считаются общественной информацией, которую можно свободно передать противнику, так же как и публичные ключи, хранящиеся в базе данных сайта. Единственный секрет хранится непосредственно в аутентификаторе и никогда не покидает его!

### Я зарегистрировал аутентификатор, но при попытке входа система говорит, что он не зарегистрирован. Это ошибка?

Это ошибка, но не в самом плагине WebAuthn.

Один или несколько плагинов на вашем сайте вызывают PHP Notices, Warnings или Errors, что портит ответ, отправленный вашим сервером. В результате JavaScript на странице не может разобрать ответ сервера и не уверен, зарегистрированы ли у пользователя какие-либо аутентификаторы.

Перейдите в админку вашего сайта, в Система, Глобальная конфигурация и установите Error Reporting на None. В большинстве случаев с неработающими основными и сторонними плагинами это достаточно. В противном случае, пожалуйста, изучите вывод запроса в инструментах разработчика вашего браузера, чтобы увидеть, что нарушает работу запроса.

### В Safari нет запроса на использование моего аутентификатора

Это больше не должно происходить с iOS 13, iPadOS 13 и macOS Catalina или любыми более поздними версиями.

Это ошибка в более старых версиях Safari. Более старые версии Safari включали поддержку WebAuthn только как экспериментальную функцию и не совсем завершенную.

### Я не могу использовать биометрический сенсор (TouchID, отпечаток пальца, Windows Hello)

Некоторые старые браузеры на базе Chromium (кроме Google Chrome proper) не имели полной поддержки встроенных аутентификаторов. Они могли зависать или вылетать при попытке их использования. Эти проблемы были решены в подобных браузерах примерно в середине 2020 года.

Если вы используете Windows, пожалуйста, помните, что ваше устройство ДОЛЖНО иметь Trusted Platform Module (TPM) чип, и он должен быть включен в BIOS. Наличие только сенсора, совместимого с Windows Hello, не является достаточным. Это мера безопасности самого стандарта WebAuthn: информация об аутентификаторе должна обрабатываться с использованием безопасного, устойчивого к подделкам оборудования, чтобы предотвратить подмену ключей (например, вирусы на компьютере не могут украсть ключ, используемый для аутентификации).

Наконец, имейте в виду, что поддержка Windows Hello все еще находится в стадии разработки и будет выпущена с Joomla 4.2.

### Если я могу использовать двухфакторный софт-аутентификатор, зачем мне bothering с аппаратным токеном?

Ключевая концепция WebAuthn — абсолютная секретность приватного ключа. Он известен только аутентификатору и должен быть невозможен для передачи кому-либо извне.

В случае аппаратного аутентификатора, будь то отдельное устройство или TPM / Secure Enclave, встроенное в ваше устройство, это обусловлено самой природой этого оборудования.

A программный аутентификатор генерирует секретный ключ и сохраняет его в файловой системе. Однако это все еще обычное программное приложение, которое работает в вашей обычной операционной системе, будь то ваш телефон или компьютер. В результате он подвержен нескольким классам атак, которые могут быть использованы для незаметного кражи информации (проблемы безопасности в самом программном обеспечении, вирусы, использующие уязвимости класса Spectre в современных ЦП и т.д.).

Таким образом, программный аутентификатор гораздо удобнее и безопаснее обычного пароля, но аппаратный аутентификатор предлагает наилучшую безопасность. Выбирайте аутентификатор в зависимости от вашего бюджета и потребностей в безопасности.

Учитывая, что цена на ключ FIDO, совместимый с WebAuthn, составляет менее €10 на Amazon, вы можете использовать аппаратный аутентификатор в большинстве практических случаев.

### Почему учетные данные зашифрованы в базе данных? Это не чрезмерно?

Единственное, что хранится в базе данных, это публичный ключ, возвращаемый аутентификатором при проведении церемонии аттестации (это формальное название регистрации аутентификатора согласно спецификации WebAuthn). Поскольку это публичный ключ, нет необходимости защищать его от прочтения. Даже если неавторизованный пользователь смог бы прочитать эту информацию, он не смог бы выдавать себя за аутентификатор, например, клонируя его.

Однако, если злонамеренный пользователь имел бы доступ на запись только к таблице `#__webauthn_credentials` базы данных, без доступа на чтение к файловой системе и без доступа на запись к другим таблицам, они могли бы внести **свою** аутентификацию и, следовательно, выдать себя за целевого пользователя в системе. Это очень теоретическая атака, поскольку им также нужно знать идентификатор пользователя, на которого они нападают, что сложно выяснить без внутреннего знания сайта. Кроме того, having доступ на запись только к этой таблице, а не ко всей базе данных (в этом случае они могли бы создать нового суперпользователя) крайне маловероятно. Тем не менее, мы шифруем учетные данные, чтобы даже эта совершенно теоретическая атака не могла быть успешной.

Мы полностью осведомлены о том, что если у пользователя есть доступ на чтение к файловой системе сервера, у него есть доступ к ключу шифрования и информации о подключении к базе данных, все из которых хранятся в configuration.php. Однако в этом случае вас уже взломали: злоумышленник может прочитать configuration.php, и, следовательно, он знает, как подключиться к вашей базе данных. В таком случае они могут сделать что угодно на вашем сайте, включая удаление всех существующих суперпользователей и создание своего собственно аккаунта суперпользователя. Таким образом, нет причин пытаться решить эту ситуацию; вы были бы полностью скомпрометированы (взломаны). Единственное, что может вас спасти, это регулярные, проверенные, сторонние резервные копии.

### Я настроил Двухфакторную аутентификацию, но я вошел без предоставления своего секретного ключа. Разве это не небезопасно?

Нет, это сделано намеренно и по дизайну.

Когда мы добавили Двухфакторную аутентификацию (TFA) в Joomla! 3.2, вы могли войти на ваш сайт только с использованием имени пользователя и пароля. Пароли могут быть украдены или угаданы. Поэтому TFA был единственным способом обеспечения некоторой безопасности на объектах с высоким риском и высокой ценностью. Это было в 2013 году.

WebAuthn — это совершенно другое решение для аутентификации, которое не имеет проблем фиксированных паролей. Он использует сильную криптографию и безопасное оборудование, чтобы сделать практически невозможным подрыв криптографических ключей аутентификации. Он также не подвержен фишингу, т.е. вас нельзя обмануть, заставив использовать его на подставном сайте, поскольку WebAuthn-креденшалы привязаны к точному доменному имени, для которого они были выданы (да, если вы используете несколько доменов для вашего сайта или переносите ваш сайт на другой домен, вам нужно будет повторно зарегистрировать все ваши WebAuthn аутентификаторы — вы правильно поняли!). В результате, аутентификация с использованием WebAuthn является невероятно надежной и превосходит причины, которые делали необходимым TFA. Это означает, что если вы успешно аутентифицируетесь с помощью WebAuthn, секретный ключ TFA не должен — и поэтому не будет — проверяться вообще.

В идеальном мире вы бы смогли входить на ваш сайт только с использованием WebAuthn. Это функция, над которой мы работаем, и вы, возможно, не захотите ее включать; в конце концов, если изменится ваше доменное имя или вы потеряете доступ к или сбросите все ваши WebAuthn аутентификаторы, вы бы лишились доступа к вашему сайту. Поэтому вы все еще должны включить TFA для вашей учетной записи пользователя на основании того, что вход по паролю все еще может использоваться в качестве запасного варианта для входа на ваш сайт и должен быть защищен от известных атак на фиксированные пароли.

### Разве TFA недостаточно хорош? Зачем нам нужно WebAuthn?

TFA сам по себе достаточно хорош в большинстве случаев, но он страдает от двух проблем.

Во-первых, у него довольно неловкий пользовательский интерфейс. Вам нужно предоставить ваш всегда меняющийся секретный ключ вместе с вашим именем пользователя и паролем. Большинство людей используют TOTP (шестизначный PIN, который меняется каждые 30 секунд), что замедляет процесс входа и может вызывать раздражение у пользователей. Использование YubiKey гораздо быстрее, но также дороже и сложнее настроить, когда у вас на сайте больше, чем пара пользователей. Также YubiKey имеет ожидаемый срок службы около 2 лет ежедневного использования при генерации одноразовых паролей (он исчерпает память, используемую для отслеживания выданных подписей).

Во-вторых, если вы используете TOTP, вы все равно подвержены проблемам с безопасностью, таким как кейлоггеры, фишинг и возможность того, что секретный ключ, используемый для генерации TOTP, будет украден. Более того, с одним миллионом возможных вариантов и тридцатью секундами на их попытку, возможно, что злоумышленник сможет оказаться удачливым, поскольку Joomla не блокирует вашу учетную запись или не применяет ограничения по скорости при неудачных попытках входа. Хотя эти защиты могут быть реализованы, сама реализация может быть использована для создания ситуации отказа в обслуживании, которая блокирует легитимного пользователя из его сайта, в то время как злоумышленник занят его проникновением. Это случай, когда лекарство хуже болезни.

WebAuthn значительно улучшает пользовательский опыт. Основные браузеры поддерживают WebAuthn и предлагают убедительный пользовательский опыт, направляя пользователей к успешному использованию аутентификаторов. Вход с помощью WebAuthn более удобен даже по сравнению с функцией автозаполнения менеджеров паролей. С последними версиями мобильных операционных систем даже тот опыт, который раньше был слегка запутанным, быстро становится проще, чем пароли и TFA когда-либо были.

Где WebAuthn действительно превосходит, так это на фронте безопасности. За счет использования безопасного оборудования и строгой проверки доменного имени сайта он практически невосприимчив к кейлоггерам, фишингу и подмене ключей. He даже имеет встроенную защиту от клонирования ключей. Да, вы все еще можете потерять ваше оборудование — но аутентификаторы FIDO2, будь то внешние устройства или встроенные, могут быть заблокированы с помощью ПИН-кода или биометрических данных. В целом, использование WebAuthn с аутентификаторами FIDO2 более устойчиво к кражам и потерям, чем ваши домашние или автомобильные ключи.

## Заметки для разработчиков

### Дополнительные кнопки входа

Модуль плагина и com_users теперь используют событие onUserLoginButtons, определяемое и вызываемое в `Joomla\CMS\Helper\AuthenticationHelper::getLoginButtons`, чтобы получить определения любых дополнительных кнопок, которые нужно разместить после стандартной кнопки входа.

Все разработчики, реализующие модуль входа или, более общим образом, форму входа, также должны использовать публичный статический метод `Joomla\CMS\Helper\AuthenticationHelper::getLoginButtons`, чтобы получить указанные определения и отобразить эти кнопки для обеспечения полной совместимости их программного обеспечения с Joomla 4.

Разработчикам, которые хотят реализовать собственные кнопки, следует изучить, как системный плагин WebAuthn реализует эту функциональность. Такие кнопки могут быть использованы для реализации сторонних служб единого входа или даже для входа с использованием сторонних сервисов идентификации, таких как те, которые предлагают популярные социальные сети (Facebook, Google, Twitter, GitHub и др.).

Это изменение не оказывает негативного влияния на обратную совместимость. Сторонние модули входа и формы входа продолжат нормально функционировать, даже если они не реализуют функцию дополнительных кнопок входа, за исключением интеграций, предоставляемых указанной функцией, таких как Web Authentication. То есть они не перестанут работать (что было бы нарушением обратной совместимости), но они не будут полноценными в плане функционала.

### Разрешение com_ajax на странице входа в административную панель

Страница входа для Администратора вносит com_ajax в белый список в AdministratorApplication, чтобы его можно было использовать для обработки запросов от гостей.

Это изменение не вызывает проблем с обратной совместимостью, пока разработчики используют разумные практики и не предполагают, что вызовом com_ajax в административной панели подтверждается, что пользователь вошел в систему. Это было бы плохой практикой безопасности. Разумная практика — использовать объект пользователя Joomla, чтобы определить, является ли это пользователем-гостем и если нет, имеет ли пользователь разрешение, необходимое для выполнения действия, запрашиваемого через com_ajax. То есть, если это изменение привело к поломке вашего кода, то ваш код уже был неисправен и в любом случае нуждался в переработке.

## Дополнительная информация

Первоначальная документация для этой функции находится в pull request по ссылке
[PR #28094](https://github.com/joomla/joomla-cms/pull/28094)

*Переведено openai.com*

