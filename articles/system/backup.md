<!-- Filename: jdocmanual?manual=user&heading=system&filename=backup.md / Display title: Резервное копирование -->

## Аварии случаются!

На создание и обслуживание веб-сайта тратится много времени, усилий и денег. Как жаль потерять всё из-за какого-нибудь нелепого случая. Создание резервных копий — простая задача для обычных сайтов. Крупным или специализированным сайтам, вероятно, потребуется консультация специалистов.  

## Стратегия резервного копирования

Сайты Joomla! состоят из двух частей:

* **Файлы**, расположенные в корневой директории Joomla. Между обновлениями файлы могут не так сильно изменяться, так как в основном связаны с кодом. Могут добавляться новые изображения и документы, а также возможно переопределение шаблонов.
* **База данных**, расположенная где-то ещё на сервере хоста. База данных содержит большинство контента сайта и может значительно изменяться, так как пользователи добавляют или редактируют контент.

Каждому владельцу сайта нужна стратегия восстановления сайта в случае катастрофы. Общий совет на форумах — это **восстановить последний бэкап**. Поэтому решите, что нужно резервировать и как часто это делать.

Хостинговые услуги часто делают **снимки** сайтов клиентов и могут восстановить сайт до его состояния вчера, на прошлой неделе или в прошлом месяце. Однако это может охватывать всё в аккаунте, например, почту и другие программные пакеты. Не полагайтесь на это для восстановления сайта Joomla.

Эта статья описывает некоторые общие **бесплатные** методы резервного копирования сайтов Joomla. Вы можете выбрать платные инструменты и/или услуги для резервного копирования, но это здесь не рассматривается.

## Akeeba Backup

Если вы используете меню администратора для навигации к **Система / Установить расширения / Установить из Интернета**, первым элементом в списке будет *Akeeba Backup*. Он стоит первым в списке, потому что имеет наибольшее количество положительных отзывов. Лишне говорить, что у него очень долгая история и безупречная репутация. Есть бесплатная версия и платная версия с некоторыми дополнительными функциями. Это общая бизнес-модель для разработчиков расширений. Не бойтесь! Бесплатная версия проста в использовании, не отвлекает и подходит для большинства сайтов. Что она делает:

* Akeeba Backup анализирует вашу установку для определения оптимальных настроек создания файла резервной копии.
* Она создает составной файл резервной копии, содержащий все файлы веб-сайта и содержимое базы данных.
* Она сохраняет резервные копии с временными метками для управления, скачивания или удаления по мере необходимости.
* Скачиваемый файл имеет формат .jpa. Рекомендуется использовать FTP для загрузки.
* Существует отдельное приложение Akeeba Kickstart для распаковки файла .jpa. Все это описано на странице управления резервными копиями Akeeba.
* После распаковки сайт устанавливается с помощью установщика Akeeba в последовательности, похожей на установку Joomla.
* Установщик изменяет конфигурацию для восстановления на другой локации и запрашивает данные новой базы данных.

Единственная проблема, которая может возникнуть, заключается в том, что файл резервной копии может быть очень большим, и вы можете превысить квоту файлового пространства, если позволите накопиться резервным копиям.

Попробуйте! Это ничего не стоит и занимает минуты, а не часы.

## Инструменты хостинга

Большинство хостинг-сервисов предоставляют инструменты для резервного копирования. Пример:

### cPanel

На странице **Инструменты** в разделе *Файлы* есть ссылка *Резервная копия*. На странице **Резервная копия** доступны три варианта:

* **Полная резервная копия:** Полная резервная копия создает архив всех файлов и конфигурации вашего веб-сайта. Вы можете использовать этот файл для переноса вашей учетной записи на другой сервер или для сохранения локальной копии ваших файлов.
* **Частичная резервная копия**
    - Скачать резервную копию домашнего каталога
    - Скачать резервную копию базы данных (с списком баз данных)

Также есть варианты **Восстановления** для каждого из этих типов резервных копий. Возможны также опции для автоматического создания резервных копий.

Отдельные папки могут быть сжаты в различные форматы, подходящие для загрузки, с использованием диспетчера файлов cPanel. База данных может быть экспортирована с использованием phpMyAdmin. Ни один из этих методов здесь не рассматривается.

## Локальные инструменты

Бывают случаи, когда может понадобиться сделать резервную копию сайта локально на ноутбуке или настольном компьютере в офисе. Например, вы можете захотеть скопировать сайт на/с хостинговую услугу на/с вашего локального компьютера. Если у вас есть локальная установка Joomla, вы можете использовать Akeeba Backup, как описано выше. В противном случае вы можете отдельно сделать резервную копию базы данных и файлов Joomla.

### mysqldump

Если вы используете MySQL, то, вероятно, у вас есть доступ к инструменту командной строки *mysqldump*. Попробуйте следующую команду:

```bash
/usr/local/mysql/bin/mysqldump -u root -p dbname > ~/tmp/dbname-dump.sql
```
где `root` — это пользователь, имеющий доступ к базе данных, и `dbname` — это имя базы данных, которую вы хотите экспортировать. Возможно, вам потребуется ввести пароль.

Вы также можете передать вывод команде zip или gzip:
```bash
/usr/local/mysql/bin/mysqldump -u root -p dbname | gzip > ~/tmp/dbname-dump.sql.gz
```

### phpMySQL

Чтобы выполнить ту же задачу с помощью локальной установки phpMyAdmin, откройте его и выберите базу данных, которую хотите экспортировать. Нажмите кнопку **Экспорт** в верхней части экрана. По умолчанию, *Быстрый* экспорт использует SQL как формат вывода. Нажмите кнопку **Экспорт**, чтобы попробовать это. Вас попросят указать выходной файл.

Если выбрать параметр *Пользовательский*, можно выбрать вариант сжатия вывода, например, без сжатия, zip или gzip. Попробуйте выполнить сжатый экспорт и нажмите кнопку **Экспорт**.

Вам нужно **проверить** экспортированную базу данных. Создайте новую базу данных, возможно, `animporttest`, чтобы она была в верхней части вашего списка баз данных. С новой пустой базой данных выберите кнопку **Импорт** в верхней части экрана. В форме импорта нажмите **Обзор**, чтобы найти файл, который вы экспортировали, а затем нажмите кнопку **Импорт**.

Проверка того стоила. Экспорт в gzip экспортировал только три таблицы. Экспорт в zip сработал нормально. Это стало очевидно по размерам экспортированных файлов. Файл zip был 4Мб, а файл gzip всего 75Кб. Должна быть ошибка где-то!

### Zip и Gzip

Эти инструменты командной строки достаточно распространены и часто используются из графического интерфейса. Например, в Finder на Mac я могу выбрать директорию, содержащую сайт Joomla, щелкнуть правой кнопкой мыши и выбрать **Сжать**. На создание zip-архива уходит несколько секунд, и это не влияет на исходные данные.

## Восстановление из резервной копии

Общие советы с форумов Joomla:

* Не восстанавливайте резервную копию поверх неисправного сайта.
* Очистите вашу базу данных, удалив все таблицы, или создайте новую базу данных и назначьте для нее пользователя.
* Удалите все каталоги и файлы в корневом каталоге Joomla.

## Akeeba Quickstart

Если вы использовали Akeeba Backup, воспользуйтесь Akeeba Quickstart для восстановления вашего
резервного копирования.
* Обратитесь к [Видеоуроку](http://akee.ba/abrestoreanywhere).
* Скачайте Akeeba Quickstart (PDF 94Kb) бесплатно.
* Проверьте, что восстановленный сайт работает правильно!

Akeeba Quickstart восстанавливает как базу данных, так и файлы Joomla. Другие методы
восстанавливают базу данных и файлы Joomla отдельно.

## Восстановление базы данных

Если у вас есть резервная копия базы данных, лучше всего использовать системные инструменты для её восстановления. *phpMyAdmin* может установить базы данных среднего размера, но на больших базах данных он может выйти за пределы времени или памяти.

Если вы используете cPanel на хостинговом сервисе, вы можете импортировать базу данных со страницы *Backup / Restore*. Это здесь не описано.

Если у вас есть доступ к командной строке, будь то на хостинговом сервисе или на вашем локальном ноутбуке или настольном компьютере, вы можете использовать команду `mysql` для импорта. Загрузите архив базы данных во временное расположение за пределами вашего веб-дерева и распакуйте его, чтобы у вас был файл с расширением `.sql`. Затем используйте следующую команду:
```
mysql -u dbusername -p -D dbname < db_dump_file.sql
```
Замените `dbusername`, `dbname` и `db_dump_file.sql` на реальные значения для вашего сайта. Вас может попросить ввести пароль пользователя базы данных. Это может занять некоторое время, но должно завершиться успешно.

## Восстановление файлов

Это простая задача по распаковке архива из вашего последнего бэкапа. 
Однако иногда это не так просто. В зависимости от вашей операционной системы 
и выбранного метода, заархивированные директории и файлы могут оказаться 
в текущей директории, в новой директории или же вам будет предложено 
указать директорию назначения. Пока вы не знаете, как именно действует ваша 
система, лучше всего запустить архив в пустой директории, распаковать его там, 
а затем переместить содержащую директорию туда, где она должна быть.

Некоторые пользователи предпочитают использовать SFTP для выгрузки файлов на 
хостинг из архивных файлов, извлеченных локально. Поскольку имеется 
тысячи файлов, это занимает довольно много времени.

В корне вашего сайта имеется файл под названием `configuration.php`. Он содержит 
имя базы данных и учетные данные для доступа. Убедитесь, что они верны для 
вашего восстановленного сайта. Доступ к этому файлу ограничен разрешениями 444. 
Их нужно изменить на 644, чтобы можно было сохранить необходимые изменения.

Если всё прошло хорошо, ваш восстановленный сайт должен работать и находиться 
в том же состоянии, в каком он был, когда был сделан бэкап.

## Копирование сайта

Существуют несколько веских причин для того, чтобы скопировать весь веб-сайт с одного сервера на другой. Например, эксперты форума часто рекомендуют пользователям создать локальную версию сайта на ноутбуке или настольном компьютере для тестирования, например, для проверки новых расширений или дизайнов. Иногда человек решает перейти на новую хостинг-службу из-за стоимости или производительности.

Какова бы ни была причина, процесс относительно прост: сделайте резервную копию на исходном сайте и восстановите её на целевом сайте. Однако стоит обратить внимание на некоторые моменты:

* Убедитесь, что целевой хост соответствует минимальным техническим требованиям Joomla. Обычно это означает версии сервера, PHP и базы данных.
* После установки вы можете обнаружить, что некоторые важные модули не были включены. Большинство хостинг-служб решат такие проблемы по запросу.

*Переведено на openai.com*

