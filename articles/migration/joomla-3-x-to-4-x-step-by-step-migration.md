<!-- Filename: Joomla_3.x_to_4.x_Step_by_Step_Migration / Display title: Joomla 3 на 4 шаг за шагом -->

## Введение

**Внимание:** Это руководство предполагает, что вы начинаете с Joomla 3.10.x. Если у вас более ранняя версия, убедитесь, что вы сначала обновите Joomla до версии 3.10, прежде чем переходить на Joomla 4. Спешки нет. Убедитесь, что все ваши расширения готовы для Joomla 4.x. Joomla 3.10.x поддерживается до 16 августа 2023 года.

Ниже приведены пошаговые инструкции по миграции сайта с версии 3.10.x на Joomla! 4.x. Хотя существует множество разных сценариев, это даст вам основную процедуру для выполнения. Очень сложные миграции, вероятно, будут связаны с установленными сторонними расширениями. Рекомендуется связаться с разработчиками сторонних расширений, установленных на вашем сайте Joomla, чтобы узнать их предложенный способ миграции их расширений.

## Шаг за шагом

### Установка местоположения разработки

1. Убедитесь, что у вас установлена последняя версия Joomla 3.10.x перед продолжением.
2. Сделайте резервную копию вашего рабочего сайта версии 3.10.x. Вы можете воспользоваться рекомендованными инструментами (см. *Рекомендованные инструменты* внизу страницы) или сделать это вручную.
    - [Основы резервного копирования для сайта на Joomla!](https://docs.joomla.org/Special:MyLanguage/Backup_Basics_for_a_Joomla!_Web_Site)
    - [Какие лучшие практики для резервного копирования сайтов?](https://docs.joomla.org/Special:MyLanguage/What_are_the_best_practices_for_site_backups%3F)
3. Убедитесь, что ваша среда соответствует [техническим требованиям для Joomla 4](https://downloads.joomla.org/technical-requirements) перед продолжением.
4. Создайте новую базу данных и нового пользователя для восстановления вашего сайта версии 3.10.x.
5. Создайте тестовый сайт или рабочую область и восстановите копию резервной копии вашего сайта версии 3.10.x в одном из следующих мест:
    - Поддомен.
    - Подкаталог.
    - Локальное устройство. Joomla имеет подробное руководство по установке XAMPP. Тем не менее [WAMP](https://www.wampserver.com/en/), [MAMP](https://www.mamp.info/en/windows/) и [LAMP](https://sourceforge.net/projects/lampas/) также являются подходящими альтернативами.
    - Новый аккаунт хостинга на временном домене в корне. (Если вы хотите сменить хост при миграции.)
      - Восстановление сайта на локальном устройстве. 
        См. [Установка Joomla локально](https://docs.joomla.org/Special:MyLanguage/Installing_Joomla_locally) и [Настройка вашей рабочей станции для разработки на Joomla](https://docs.joomla.org/Special:MyLanguage/Setting_up_your_workstation_for_Joomla_development).
      - Восстановление сайта с помощью инструмента, указанного внизу страницы. (Читаете документацию разработчика.)
6. В вашем тестовом местоположении обновите вашу установку Joomla! 3.10.x до последнего выпуска.
7. Убедитесь, что у вас обновлена последняя схема базы данных до последней версии 3.10.x, перейдя на вкладку **Менеджер расширений → База данных**. Если ваша схема не обновлена, как на следующем изображении, нажмите кнопку **Исправить**:<br>
    ![База данных расширений Joomla 3](../../../en/images/migration/admin-extension-database-fix.png)
8. Очистите корзину: есть ли у вас статьи в корзине? Если да, удалите их (и любые связанные с ними медиафайлы, если они не используются в других местах сайта). Статьи (категории и элементы меню тоже), оставленные в корзине, могут вызвать ошибки при миграции.
9. Тестируйте.
10. Сделайте резервную копию снова.

### Оценка каждого расширения

В вашем планировании вы определили, какие сторонние расширения останутся или исчезнут и как они будут мигрированы. Для этой части программы «Шаг за шагом» вы будете интенсивно использовать два разных раздела сайта: *Предварительная проверка обновлений* в **Компоненты → Обновление Joomla!** и **Расширения → Управление → Управление**. Вы собираетесь проверить каждое установленное на вашем сайте расширение. Вы будете определять, нужно ли их обновлять до последней версии или удалять. Подробнее в [Предварительная проверка обновлений](https://docs.joomla.org/Special:MyLanguage/:Pre-Update_Check).

1. Для использования **Предварительной проверки обновлений** вам нужно установить компонент обновления Joomla! на Joomla 4. Для этого следуйте:
2. Перейдите к **Компоненты → Обновление Joomla**. Должно быть указано, что обновлений не найдено. Если это не так, обновите Joomla до последней версии (должна быть 3.10.x) и протестируйте. Затем сделайте ещё одну резервную копию. Нажмите кнопку Параметры в правом верхнем углу.
3. Выберите *Следующая Joomla* в раскрывающемся списке для Обновления канала.<br>
    ![выбор канала параметров обновления](../../../en/images/migration/update-options-channel.png)
4. Нажмите **Сохранить и закрыть**
5. Затем вы увидите вашу установленную версию Joomla, последнюю версию Joomla! и URL-адрес пакета обновления. Joomla покажет вам требования к Joomla 4. Если она указывает, что у вас либо несовместимая система, либо расширения, она сообщит вам об этом здесь. Внимательно просмотрите эту страницу. <br>
    ![Обновление до версии 4 предварительная проверка](../../../en/images/migration/update-to-4-pre-update-check.png)
    <div class="alert alert-warning"><strong>Внимание:</strong> Не обновляйтесь до Joomla! 4 прямо сейчас. Это только для подготовки ваших сторонних расширений и обеспечения совместимости сайта с Joomla! 4.</div>
6. Просмотрите Предварительную проверку обновлений и проверку расширений в разделе Предварительной проверки обновлений компонента Обновление Joomla. Если здесь указано какое-либо расширение, не запланированное на удаление, добавьте его в список расширений для расследования.
7. Если вы мигрировали с Joomla! 2.5 на 3.x в прошлом, может остаться несколько расширений, которые нужно очистить. Следующие являются более старыми для версий 2.5 или 3.x, и их необходимо удалить перед обновлением до Joomla4:
    - plg_content_geshi
    - Шаблон администратора Bluestork
    - Beez_20
    - Beez5
    - Atomic
    1. Для шаблонов удаляйте все основные шаблоны переднего или заднего плана, кроме Protostar и Beez3 (шаблоны переднего плана) и Isis или Hathor (администраторские шаблоны). **ПРИМЕЧАНИЕ: Protostar НЕ совместим с Joomla 4**. После миграции он исчезнет. Вам необходимо, чтобы один шаблон был выбран как *по умолчанию*, и вы можете использовать Protostar или Beez3. Protostar исчезнет после миграции на Joomla 4.x.
    2. Если вы обнаружите другие файлы, которые нужно удалить, пожалуйста, добавьте их на эту страницу. Это вики, поэтому любой может добавить информацию. Заранее спасибо за вашу помощь.
8. Обратите внимание на метки для определения, совместимо расширение или нет. Эти метки, как правило, говорят правду, если они говорят «Нет» или «Да». Если они говорят *Отсутствует метка совместимости*, это означает, что разработчик расширения не использовал метку в своем расширении, и мы не знаем, совместимо оно или нет с Joomla 4. Свяжитесь с разработчиком для подтверждения.
9. **Обновите расширения:** обновите любые расширения, которые вы оставите на своем сайте. В Joomla! 3.10.x вы можете перейти в **Менеджер расширений → Вкладка обновлений** и нажать **Найти обновления**, что добавит всплывающую подсказку в столбце Версия на вкладке Управление, предоставляя информацию о совместимости из бэкэнда. Эта функциональность поддерживает только расширения, которые обновляются через вкладку Обновления Менеджера расширений. Если у вас установлены расширения, не использующие обновление расширения Joomla, их необходимо оценивать вручную, как подробно описано ниже. То же самое касается тех расширений, которые имеют всплывающую подсказку. Вам все равно нужно проверить тип пакета и путь обновления у разработчика расширения, чтобы узнать, как обновиться/мигрировать.
10. Исследуйте и удалите расширения: перейдите в **Менеджер расширений → Управление**.
11. Нажмите кнопку *Поиск инструментов*, чтобы отобразить параметры фильтра.
12. Выберите Пакет из раскрывающегося списка *Выбрать тип*.<br>
    ![страница управления расширениями](../../../en/images/migration/extensions-manage.png)
    <div class="alert alert-info">Рекомендуется сначала выбрать Тип пакета, потому что при удалении пакета автоматически удаляются связанные Модули, Плагины и все остальное в пакете за один раз.</div>
13. Удалите любые пакеты, которые больше не нужны или не будут мигрироваться на Joomla 4.
14. Повторите этот процесс, перебрав все Типы в раскрывающемся списке на вкладке Управление: Компонент, Файл, Язык, Библиотека, Модуль, Плагин и Шаблон. Если Автор указывает проект Joomla!, то оставьте эти расширения. Для всех остальных убедитесь, что удалили те, которые не используются или не совместимы с Joomla! 4.x. 
    <div class="alert alert-danger"><strong>ПРИМЕЧАНИЕ!</strong> У вас не получится удалить шаблон, установленный по умолчанию. Вам нужно выбрать поддерживаемый шаблон Core, например, Beez3 или Protostar, а затем удалить шаблон, если это необходимо. <em>Ещё одно напоминание:</em> <strong>Protostar несовместим с Joomla 4</strong>. После миграции он исчезнет. Выбрав его как шаблон по умолчанию, вы просто переходите на Joomla 4.x.</div>
15. Запишите все версии Пакетов и Компонентов, которые вы оставите на сайте. Вы можете скопировать/вставить их в документ для справки.
16. Для любых расширений, которые вы оставляете и которые не используют Менеджер расширений для одномоментного обновления (**Расширения → Управление → Обновление**), обновите все до последних версий.
17. Перед и во время обновления обратите внимание, если у расширений есть версии как для 3.10.x, так и 4.x в одном пакете. Если да, они будут нормально обновляться одномоментно. Если нет и для 3.10 и 4.x есть разные пакеты, вам нужно рассмотреть каждый случай индивидуально. Обычно они попадают в одну из следующих ситуаций:
    - У расширения разные пакеты, но при обновлении до 4.x они автоматически распознают это и продолжают работать. Убедитесь, что разработчик подтверждает это.
    - У расширения разные пакеты, которые нужно удалить в 3.10.x и затем установить с версией Joomla 4.x после миграции сайта. Примером этого может быть плагин содержимого. Его очень просто удалить в 3.10.x и затем установить снова в 4.x.
    - См. [Рассмотрение шаблонов](https://docs.joomla.org/Special:MyLanguage/Template_Considerations_During_Migration) для более подробной информации о шаблонах и [Конвертация шаблона предыдущей версии Joomla!](https://docs.joomla.org/J3.x:Converting_A_Previous_Joomla!_Version_Template)

#### Заметки о поиске (com_search)

Поиск (com_search) будет отделен в Joomla 4.x. Поиск (com_search) будет мигрирован на Joomla 4. После миграции вам потребуется обновить его до версии Joomla 4.x через com_installer. Он будет продолжать поддерживаться, но более как стороннее расширение, получающее обновления через com_installer. Рекомендуется использовать Умный поиск (com_finder) в дальнейшем. Поиск все еще доступен в [Каталоге расширений Joomla](https://extensions.joomla.org/category/official-extensions/).

#### Заметки о Веб-ссылках

Веб-ссылки были отделены еще в Joomla 3.4. Если они использовались на сайте версии 2.5, процесс миграции учтет это и перенесет компонент и данные Веб-ссылок. Для миграции с 3.10.x на 4.x ситуация будет такой же. Они все еще доступны и поддерживаются в JED на [Официальные расширения](https://extensions.joomla.org/category/official-extensions).

#### Заметки о старой маршрутизации

Старая маршрутизация не будет доступна в Joomla 4.x. Будет доступна только Современная. После миграции, если вы используете старую маршрутизацию, система автоматически переключит её на Современную маршрутизацию. Вам нужно будет провести проверку битых ссылок на своем сайте после миграции на Joomla 4.x и *до того, как вы запустите сайт*.

### Переход на Joomla! 4.x

Как только вы обновили или удалили ваши сторонние расширения так, чтобы только совместимые с Joomla! 4 остались в вашей установке, продолжите выполнение следующих шагов:

1. Перейдите в **Система → Общие настройки → Вкладка сервера** и измените Отчет об ошибках с По умолчанию на Максимум. Убедитесь, что нажали Сохранить и Закрыть.<br>
    ![общие настройки системы вкладка сервера](../../../en/images/migration/system-global-configuration-server-tab.png)
2. Сделайте еще одну резервную копию.
3. Перейдите в **Компоненты → Обновление Joomla**. (Должно быть указано, что обновлений не найдено. Если это не так, обновите Joomla до последней версии и протестируйте. Затем сделайте ещё одну резервную копию.) Нажмите на кнопку Параметры в правом верхнем углу.
4. Выберите *Следующая Joomla* из выпадающего списка для Обновления канала.<br>
    ![компонент Joomla update выбор обновить канал](../../../en/images/migration/update-select-channel.png)
5. Нажмите **Сохранить и Закрыть**.
6. Затем вы увидите вашу установленную версию Joomla, последнюю версию Joomla! и URL-адрес пакета обновления. Joomla покажет вам требования к Joomla 4. Если она указывает, что у вас либо несовместимая система, либо расширения, она сообщит вам об этом здесь. Внимательно просмотрите эту страницу.<br>
    ![проверка обновления версии 4](../../../en/images/migration/update-check.png)
7. Если обновление не отображается, перейдите в **Менеджер расширений → Обновление** и нажмите Очистить кэш на панели инструментов. Теперь обновление до Joomla! 4 должно отображаться.
8. Скрестите пальцы, и убедитесь, что у вас есть эта резервная копия на случай.
9. Нажмите кнопку Установить обновление.
10. Сделайте чай, пока индикатор статуса полностью готов. Время, которое на это потребуется, зависит от вашего сайта, интернет-соединения и скорости сервера. Процесс занимает около двух минут. Когда обновление завершится, вас могут выкинуть из Администратора. Войдите снова. Дважды.
11. Если всё идёт хорошо, вы увидите совершенно новый интерфейс панели администратора.<br>
    ![домашняя панель Joomla 4 или 5](../../../en/images/migration/j4-home-dashboard.png)
12. Перейдите в **Система → Обслуживание → База данных** и нажмите *Исправить*, если появляются какие-либо ошибки.
13. В **Система → Установить → Обнаружение** проверьте, есть ли какие-нибудь расширения для установки. (Не должно быть!)
14. Перейдите на фронтэнд вашего сайта и убедитесь, что он отображается, даже если это не тот шаблон. Если да, продолжайте. Если нет, просмотрите common errors during migration.
15. Сделайте резервную копию.
16. Установите ваш новый шаблон или другие расширения, если они у вас есть для установки. Чаще делайте резервные копии.
17. Настройте их. Чаще делайте резервные копии.
18. Проведите проверку битых ссылок и исправьте любые битые.
19. Протестируйте всё. Чаще делайте резервные копии.
20. Если всё работает как ожидалось, верните Отчет об ошибках на По умолчанию (**Система → Общие настройки → Вкладка сервера**). Убедитесь, что нажали **Сохранить и Закрыть**.

### Запуск вашего сайта Joomla! 4.x

1. Когда вы будете готовы выйти в публичный доступ, сделайте последнюю резервную копию вашего сайта версии 3.10. Восстановите его в подкаталоге или поддомене, если хотите.
2. Сделайте резервную копию вашего сайта Joomla! 4.x и перенесите или восстановите ваш сайт Joomla! 4.x в корень (или измените серверы имен, если вы строили на временном домене с новым аккаунтом хостинга в корне).
3. Протестируйте снова.
4. ЕСЛИ вы вносили изменения в файл .htaccess для безопасности в прошлом, возможно, вам потребуется изменить строку (или строки) в нем, чтобы обновиться до следующей версии Joomla 4. Перейдите в [Изменения Htaccess после Joomla 4](https://docs.joomla.org/Htaccess_changes_after_joomla4.0.4), чтобы определить, нужно ли вам менять файл или нет.
5. Удалите сайт Joomla! 3.10 с сервера в течение нескольких дней, если вы не отредактировали ваш файл *robots.txt* для блокировки поисковым системам.
6. Удалите все сайты разработки, с которыми вы работали, или держите их обновленными, если они работают на текущей версии, чтобы предотвратить хакерские атаки на ваш сервер.

Если данные изменялись на сайте 3.10 в процессе миграции на 4.x, вам нужно будет перенести эти данные на сайт 4.x перед запуском. Вы можете сделать это вручную (убедитесь, что сохранили те же идентификаторы пользователей — идите по порядку) или с помощью [стороннего расширения](https://extensions.joomla.org/category/migration-a-conversion/data-import-a-export%20transfer%20tool/third-party%20extension/).

## Рекомендуемые инструменты

- [Akeeba Backup](http://extensions.joomla.org/extensions/access-a-security/site-security/backup/1606)
  очень популярен для резервного копирования и восстановления.
- Дополнительные [инструменты для резервного копирования](https://extensions.joomla.org/tags/backup/).

*Переведено с помощью openai.com*

