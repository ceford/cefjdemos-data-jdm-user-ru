<!-- Filename: J4.x:Template_Layouts / Display title: Шаблоны макетов   -->

## Структуры файлов макета

В **шаблоне** каждый расширение, которое генерирует HTML-вывод, размещает код вывода в файле шаблона внутри структуры файлов расширения, часто в папке с названием tmpl. Некоторые примеры:

- /modules/mod_login/tmpl/default.php
- /modules/mod_login/tmpl/default_logout.php
- /components/com_content/tmpl/article/default.php
- /plugins/content/vote/tmpl/vote.php

В **переопределении шаблона** создается файл с тем же именем в структуре файлов шаблона, и он используется вместо файла в структуре файлов расширения. Соответствующие примеры:

- /templates/cassiopeia/html/mod_login/default.php
- /templates/cassiopeia/html/mod_login/default_logout.php
- /templates/cassiopeia/html/com_content/article/default.php
- /templates/cassiopeia/html/plg_content_vote/vote.php

Это позволяет вам настроить вывод под ваши нужды. Однако у вас нет возможности выбрать, использовать ли переопределение. Оно всегда используется.

В **альтернативном макете шаблона** вы создаете файл с другим именем, отличным от оригинала, но в той же папке шаблонов. Новое имя не должно содержать подчеркивания. Вы также создаете любой файл, совпадающий по началу с оригинальным именем. Пример:

- /templates/cassiopeia/html/mod_login/expires.php
- /templates/cassiopeia/html/mod_login/expires_logout.php

Затем становится возможным выбрать, использовать ли оригинальный стандартный макет или альтернативный макет. Выбор осуществляется в форме редактирования модуля или компонента (вкладка «Дополнительно» для модулей, вкладка «Опции» для статей). Обратите внимание, что не все расширения допускают либо переопределения, либо альтернативные макеты.

**Будьте осторожны:** плагины не предоставляют механизм для выбора альтернативных макетов.

## Альтернативные макеты модулей

Создание альтернативного макета для модуля похоже на создание
переопределения шаблона для модуля. В обоих случаях вы создаете папку
под названием `templates/.../html/`. Например, папка для переопределения шаблона "mod_login" или альтернативного макета для шаблона cassiopeia
будет `templates/cassiopeia/html/mod_login/`.

Существует два важных различия между переопределением шаблона и
альтернативным макетом. Первым является имя файла. Для
переопределения шаблона, имя файла должно быть `default.php`, чтобы оно соответствовало названию основного файла. Для альтернативного макета используйте другое имя. Единственное правило заключается в том, что **имя файла не должно содержать подчеркивания**.

Второе важное различие состоит в том, что, в отличие от файлов переопределения шаблона, которые используются автоматически каждый раз, когда модуль отображается с использованием шаблона с переопределением, альтернативный файл макета используется только в том случае, если вы выберете его в качестве параметра в настройках параметров модуля.

### Пример с работой - mod_login

- Перейдите в **Система** → **Шаблоны сайта** → **Детали и файлы Cassiopeia**
- Выберите вкладку **Создать переопределения**.
- В списке Модулей выберите элемент **mod_login**.
- На вкладке Редактор выберите **html** → **mod_login**, чтобы увидеть
  новосозданные копии шаблонов вывода mod_login.
- Переименуйте **default.php** во что-то другое, без подчеркивания, например **expires.php**.
- Переименуйте **default_logout.php** в **expires_logout.php**.

Теперь у вас есть два файла с точно таким же содержимым, как у оригиналов.
Измените содержимое expires_logout.php, чтобы добавить сообщение,
уведомляющее пользователя о времени истечения сессии после каждой загрузки страницы.

На строке 16 сразу под существующими use-операторами добавьте следующее:

```php
use Joomla\CMS\Factory;

date_default_timezone_set('Europe/London');
$config = Factory::getContainer()->get('config');
$lifetime = $config->get('lifetime', 0);
$time = time() + $lifetime * 60;
$endTime = date('H:i:s', $time); // time() уже возвращает время в секундах
```

И на 36-й строке сразу после строки содержащей endif добавьте этот код:

```html
<p class="text-center">
Ваша сессия закончится в <br><?php echo $endTime; ?>
</p>
```

Закройте файлы Cassiopeia. Выберите **Содержимое** → **Модули сайта** и
откройте модуль Входа. В расширенной вкладке, в элементе Макет вы найдете
что у вас есть выбор между **-- Из модуля -- / По умолчанию** и 
**-- Из шаблона cassiopeia -- / expires**.

![модуль входа, показывающий альтернативные макеты](../../../en/images/templates/layouts-module-login.png)

Один из способов использования этой функции – иметь две формы входа, одну для доступа для Всеобщего пользования и другую для доступа Суперпользователей. В последнем случае выберите опцию **expires** и только Суперпользователи увидят напоминание о времени окончания сессии.

Важно понять, что если в параметрах модуля
указан альтернативный файл макета для модуля, он будет использоваться для этого модуля независимо от того, какой шаблон используется для отображения страницы, где
показан модуль. Поэтому на администраторе лежит ответственность
убедиться, что файл макета будет работать, как нужно, в любых шаблонах,
где может быть показан этот модуль.

### Перевод

Вы можете перевести имя файла, используя Переопределения языка. Попробуйте следующую процедуру:

- Выберите **Система** → **Панель управления** → **Переопределения языка**
- Выберите ваш язык и локацию Администратора.
- Нажмите на кнопку **Новый** и заполните форму. В этом примере
  ключ языка это **TPL_CASSIOPEIA_MOD_LOGIN_LAYOUT_EXPIRES**, а текст может быть **Вход / Выход с указанием времени истечения**
- Сохраните и закройте, после чего вернитесь к форме модуля Входа.

![форма редактирования языка](../../../en/images/templates/layouts-language-override-form.png)

Поле выбора макета модуля с переведенным **expires**:

![выбор альтернативных макетов модуля](../../../en/images/templates/layouts-example-translated.png)
```

## Альтернативные компоновки компонентов

Альтернативные компоновки компонентов работают аналогично макетам модулей. Файл размещается в той же папке, где вы размещаете файл переопределения шаблона. Например, чтобы создать альтернативную компоновку для статьи для шаблона "cassiopeia", вы должны поместить файл в папку `templates/cassiopeia/html/com_content/article/`. Как и в случае с макетами модулей, файл не должен называться так же, как основной файл, и в его названии не должно быть подчеркиваний. Кроме того, в этой папке не должно быть XML-файла с таким же именем. (Мы обсудим XML-файлы ниже в разделе об альтернативных компоновках пунктов меню.)

Вы можете установить глобальное значение для компоновок компонентов в окне Параметры компонента. Например, в окне Параметры статьи есть параметр *Выбрать компоновку*, как показано ниже:

![окно параметров статьи с списком альтернативных компоновок](../../../en/images/templates/layouts-articles-options.png)

Как и с макетами модулей, компоновки компонента отображаются в виде параметров на экране редактирования отдельного компонента. Например, для статьи параметр отображается на вкладке Редактирование статьи: Параметры, как показано ниже.

![форма редактирования статьи с отображением списка альтернативных компоновок](../../../en/images/templates/layout-article-edit.png)

Как и с другими параметрами, опция "Использовать глобальные настройки" использует настройку из параметра Параметры. Опция "Из настройки компонента по умолчанию" использует компоновку компонента по умолчанию. Альтернативные компоновки, которые вы создали для разных шаблонов, отображаются под каждым заголовком шаблона.

Имена файлов могут быть переведены. Строка ниже:
```ini
    TPL_CASSIOPEIA_COM_CONTENT_ARTICLE_LAYOUT_MYLAYOUT="Только заголовок без XML"
```
переведет файл с именем "mylayout.php" как "Только заголовок без XML".

Вы можете иметь более одного файла для компоновки. Начальный файл должен быть назван без подчеркиваний, и любые дополнительные файлы должны иметь подчеркивания.

Альтернативные компоновки компонентов могут использоваться со статьями, контактами или лентами новостей.

Альтернативные компоновки компонентов используются только при выполнении двух условий: (1) они указаны в параметрах компонента; и (2) для этого конкретного компонента нет элемента меню. Например, если у вас есть один или несколько элементов меню типа "Одна статья", настроенных для данной статьи, альтернативная компоновка для этой статьи не будет использоваться. Вместо этого будет использоваться компоновка, указанная в элементе меню. Это согласуется с общим принципом работы параметров компонента, где наиболее конкретная настройка (в данном случае элемент меню для одной статьи) переопределяет менее конкретную (в данном случае параметры статьи).

## Альтернативные макеты категорий

Альтернативные макеты категорий работают так же, как и макеты компонентов. Правила для указания файлов макета те же. Единственное отличие заключается в том, что папка относится к категории, а не к компоненту. Например, альтернативный макет категории контактов для cassiopeia будет находиться в папке `templates/cassiopeia/html/com_contact/category`.

Вы можете задать макеты категорий глобально, в экране "Параметры" каждого компонента. Ниже приведен пример из "Контакты: Параметры / Форма категории":

![форма параметров компонента контактов с отображением альтернативных макетов](../../../en/images/templates/layouts-contacts-options.png)

Альтернативные макеты категорий отображаются, когда вы добавляете или редактируете категорию в форме "Компонент: Редактирование категории / Параметры", как показано ниже.

![форма параметров компонента контактов с отображением альтернативных макетов](../../../en/images/templates/layouts-contacts-category-options.png)

Альтернативные макеты категорий могут использоваться для статей, баннеров, контактов и лент новостей.

Как и в случае с макетами компонентов, макет категории будет использоваться только если:

1. он выбран в глобальных параметрах или в параметрах категории.
2. нет пункта меню специально для этой категории.

Если для конкретной категории настроен пункт меню, будет использоваться макет, выбранный в меню, вместо альтернативного макета категории.

## Категория статьи: Блог и Список

Для статей доступны два основных макета категорий: Блог и Список. Каждый из этих макетов отображается в формах параметров статей на вкладке Категория под заголовком "Из компонента". В списке также появляются альтернативные макеты, позволяющие выбрать макет по умолчанию для категории в виде Блога, Списка или альтернативных шаблонов как глобально, так и при редактировании одной категории статьи.

![форма параметров компонента контактов, показывающая альтернативные макеты](../../../en/images/templates/layouts-articles-options-category.png)

Это означает, что, как и другие параметры макета, вы можете управлять тем, используют ли ссылки на категории статей макеты блога или списка. Важно понимать, что, как и другие параметры макета, этот параметр будет действовать только в случае отсутствия пункта меню для одной категории.

## Альтернативные пункты меню

Альтернативные пункты меню имеют одно важное отличие от других. Чтобы
создать альтернативный макет пункта меню, вы должны включить XML-файл,
имя которого совпадает с исходным файлом макета. Например, чтобы создать
альтернативный пункт меню под названием "myarticle" для статьи в шаблоне
cassiopeia, вы создаете два файла в папке
`templates/cassiopeia/html/com_content/article` с именами
`myarticle.php` и `myarticle.xml`. Если вы хотите включить больше файлов
макета, вы добавляете эти файлы с подчеркиваниями в именах файлов.

XML-файл использует тот же формат, что и основные XML-файлы пунктов меню.
Это позволяет не только создать индивидуальный макет для данного пункта меню,
но и настроить параметры. Например, вы можете скрыть некоторые параметры или
добавить новые.

Альтернативные пункты меню появляются, когда вы выбираете Тип пункта меню,
как показано ниже.

![список выбора пункта меню](../../../en/images/templates/layouts-menu-blog-menu-creation.png)

Альтернативные пункты меню используются и работают так же, как и стандартные
пункты меню. Поскольку они уже основаны на индивидуальных макетах, 
переопределения шаблона не применяются к альтернативным пунктам меню.

Как указано выше, макеты пунктов меню имеют приоритет над альтернативными
макетами компонентов или категорий.

Перевод альтернативных пунктов меню осуществляется с помощью следующих
тегов в XML-файлах. Формат: `"TPL_"<имя шаблона>_<компонент>_<вид>_<имя пункта меню>_<тип тега>`. Например, приведенные ниже строки будут переводить
название, опцию и описание для альтернативного пункта меню под названием
"catmenuitem".
```
    TPL_CASSIOPEIA_COM_CONTENT_CATEGORY_VIEW_CATMENUITEM_TITLE="Cassiopeia пользовательский макет категории"
    TPL_CASSIOPEIA_COM_CONTENT_CATEGORY_VIEW_CATMENUITEM_OPTION="Cassiopeia пользовательский"
    TPL_CASSIOPEIA_COM_CONTENT_CATEGORY_VIEW_CATMENUITEM_DESC="Описание для пользовательского макета категории cassiopeia."
```
Эти строки должны быть добавлены в
`administrator/language/overrides/en-GB.override.ini`, но вы можете
использовать форму переопределений языка, описанную выше.

Файл catmenuitem.xml начнется с:

```xml
<?xml version="1.0" encoding="utf-8"?>
<metadata>
   <layout title="TPL_CASSIOPEIA_COM_CONTENT_CATEGORY_VIEW_CATMENUITEM_TITLE" option="TPL_CASSIOPEIA_COM_CONTENT_CATEGORY_VIEW_CATMENUITEM_OPTION">
      <help
         key = "JHELP_MENUS_MENU_ITEM_ARTICLE_SINGLE_ARTICLE"
      />
      <message>
         <![CDATA[TPL_CASSIOPEIA_COM_CONTENT_CATEGORY_VIEW_CATMENUITEM_DESC]]>
      </message>
   </layout>
```

## Управление шаблоном для альтернативных пунктов меню

Как обсуждалось выше, наличие XML-файла делает макет пункта меню альтернативным. Формат XML-файла такой же, как и формат XML-файлов основных пунктов меню. С помощью этого XML-файла вы можете добавить параметры, которые хотите включить для этого пункта меню. Они могут быть такими же, как у одного из основных пунктов меню, или вы можете опустить основные параметры или добавить новые. Обратите внимание, что если вы добавите новые параметры, они могут использоваться в файле макета, но не будут использоваться в файлах основной модели или представления.

Также возможно переопределить настройки параметров для основных параметров. Один из примеров — управление тем, с какими шаблонами может отображаться макет альтернативного пункта меню. В некоторых случаях вы можете захотеть, чтобы пользовательский пункт меню отображался с любым шаблоном для сайта. В других случаях вы можете захотеть ограничить макет этого пункта меню до одного конкретного шаблона. В этой ситуации вы просто добавите следующий параметр в XML-файл пункта меню:

```xml
<fields>
  <field
    name="template_style_id"
    type="templatestyle"
    label="COM_MENUS_ITEM_FIELD_TEMPLATE_LABEL"
    description="COM_MENUS_ITEM_FIELD_TEMPLATE_DESC"
    filter="int"
    template="cassiopeia"
    class="inputbox">
  </field>
</fields>
```

Это переопределит основной параметр `template_style_id`. Установка шаблона равного "cassiopeia" в этом случае ограничит пользователя только выбором стилей шаблона для шаблона "cassiopeia".

## Дополнительная информация

- Основы
  шаблона
- Папки и файлы
  шаблона Cassiopeia
- Настройка
  шаблона Cassiopeia
- Переопределения
  шаблона
- Макеты
  шаблона
- Упрощенный шаблон Cassiopeia - Пример -
  простой шаблон на основе Cassiopeia

*Переведено с помощью openai.com*

