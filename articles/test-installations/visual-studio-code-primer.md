<!-- Filename: Visual_Studio_Code_Primer / Display title: Введение в Visual Studio Code -->

## VS Code - Популярная бесплатная IDE

Из Википедии:

> Visual Studio Code, также известная как VS Code, — это редактор
> исходного кода, разработанный компанией Microsoft для Windows, Linux и macOS.
> Среди функций: поддержка отладки, подсветка синтаксиса,
> интеллектуальное завершение кода, сниппеты, рефакторинг кода и встроенный
> Git. Пользователи могут изменять тему, сочетания клавиш, настройки и
> устанавливать расширения, которые добавляют дополнительную функциональность.

## Установка

На сайте VS Code на странице по умолчанию есть выпадающий список для каждой поддерживаемой платформы. Скорее всего, ваша платформа будет выбрана автоматически. Просто скачайте и установите - и вы готовы начать.

### Начало работы

На странице *Начало работы* в VS Code есть несколько элементов *Начать*, список недавних элементов и короткий список *Обзоров*. Если вы полностью новичок в VS Code, то рекомендуется их просмотр. Это займет всего несколько минут.

Документация по VS Code доступна в меню *Справка / Документация*. [Вводные видеоролики](https://code.visualstudio.com/docs/getstarted/introvideos) определенно стоит посмотреть. Каждый из них длится от 2 до 6 минут и дает отличное введение в функции VS Code.

Официальная документация - это место, куда стоит обратиться, если вам нужно найти конкретную информацию.

### Расширения для VS Code

VS Code может использоваться для любого типа текста, включая широкий спектр языков программирования. Он работает с JavaScript без добавления расширений. Другие языки определяются по контексту, так что если вы начнете создавать и сохранять код PHP, вам, вероятно, будет предложено установить пакет поддержки PHP.

Щелкните значок *Расширения* в левой *Панели действий*, чтобы увидеть, что у вас уже установлено и что рекомендуется. Вам потребуется расширение PHP Debug!

### Макет экрана VS Code

Некоторые термины, использованные в последующих инструкциях:

- **Панель действий** - узкая полоса слева на экране. Выберите любой
  значок, чтобы открыть или закрыть Основную боковую панель.
- **Основная боковая панель** при открытии показывает детали выбранной активности.
- **Строка состояния** внизу экрана показывает, что происходит.
- **Панель** - область под текстовыми редакторами для отображения другой информации.

Выберите значок макета в правом верхнем углу, чтобы открыть или закрыть любой из этих элементов.

## Создание расширения для Joomla

Чтобы создать расширение, ваша цель — создать zip-файл, который можно установить на работающем сайте Joomla. Поэтому вам понадобится папка, чтобы разместить ваш код. Она должна находиться в вашем личном файловом пространстве на вашем ноутбуке или настольном компьютере, используемом для локальной разработки. Она не должна находиться в дереве вашего сайта. Например, вы можете использовать *~/jextensions* для размещения подпапок разных расширений. Я использую *~/git*, потому что это коротко и легко произносится, хотя потенциально сбивает с толку, так как каждая подпапка использует отдельный репозиторий git.

### Пример кода

Если вы хотите работать с примером кода, доступно расширение на GitHub под названием *mod_debugme*. Как следует из названия, это модуль с некоторыми ошибками. Помимо кода модуля, имеется файл *build.xml*, чтобы показать один из способов автоматизации сборки для тестирования и создания zip-файла.

Модуль предназначен для отображения следующих нескольких (по умолчанию 3) событий (дни рождения) из списка, хранящегося в таблице базы данных. Это может быть использовано на офисном или семейном сайте в ожидании торта.

Возможно, лучше всего начать, используя команды git с командной строки. Сначала создайте папку для вашего кода и затем клонируйте удаленный репозиторий:
```sh
    mkdir ~/git
    cd ~/git
    git clone https://github.com/ceford/j4xdemos-mod-debugme
```
Ответ должен занять всего несколько секунд:
```sh
    Cloning into 'j4xdemos-mod-debugme'...
    remote: Enumerating objects: 23, done.
    remote: Counting objects: 100% (23/23), done.
    remote: Compressing objects: 100% (16/16), done.
    remote: Total 23 (delta 3), reused 23 (delta 3), pack-reused 0
    Unpacking objects: 100% (23/23), done.
```
Вы должны уделить немного времени на просмотр содержимого папки:
```sh
    cd j4xdemos-mod-debugme
    ls -al
    total 16
    drwxr-xr-x   6 ceford  staff   192  2 Sep 17:48 .
    drwxr-xr-x   3 ceford  staff    96  2 Sep 17:48 ..
    drwxr-xr-x  12 ceford  staff   384  2 Sep 17:48 .git
    -rw-r--r--   1 ceford  staff  1402  2 Sep 17:48 README.md
    -rw-r--r--   1 ceford  staff   927  2 Sep 17:48 build.xml
    drwxr-xr-x   8 ceford  staff   256  2 Sep 17:48 mod_debugme
```
Папка *.git* содержит информацию о репозитории. Файл *README.md* является markdown-документом, описывающим этот репозиторий. Файл *build.xml* используется для сборки расширения с помощью внешнего инструмента, Phing — описанного позднее. Папка *mod_debugme* содержит код расширения.

### Установка в Joomla

Сожмите папку расширения для создания устанавливаемого zip-файла:
```sh
    zip -r mod_debugme.zip mod_debugme
```
Теперь вы можете установить zip-файл на сайте Joomla, который вы используете для тестирования. После установки вам нужно создать модуль Сайта и назначить его на позицию модуля. Поскольку это неисправный модуль, вы можете назначить его на позицию на *Всех страницах*, пока работаете над ним; или вы можете назначить его на позицию на одной странице; или вы можете разместить его в статье, у которой есть свой пункт меню.

После установки удалите zip-файл.

### Включение режима отладки

В глобальной конфигурации Joomla установите *Система отладки* на *Да* и *Сообщение об ошибках* на *Максимум*.

При открытии страницы с баг-овым модулем вы увидите трассировку стека, показывающую, где была вызвана ошибка.

![трассировка стека vscode](../../../en/images/test-installations/vscode-primer-stack-trace.png)

Иногда ошибка в кодировании находится на первой строке трассировки стека. В противном случае, если ошибка вызвана в библиотечном коде, например, путем передачи неверных данных в функцию базы данных, ошибка в кодировании может быть дальше по списку вызовов функций.

## Открытие папки расширений в VS Code

В VS Code используйте меню Файл / Открыть папку, чтобы найти и открыть папку, содержащую локальную копию кода расширения *mod_debugme*. Вы должны увидеть что-то похожее на следующее:

![взгляд на папку vscode](../../../en/images/test-installations/vscode-primer-screen.png)

Возможно, вы сможете диагностировать проблему, просто прочитав код. В случае ошибки *Класс "DebugHelper" не найден* вы увидите, что оператор *use* был закомментирован несколькими строками выше. Забыть вставить оператор *use* - распространенная ошибка на начальном этапе разработки!

Исправьте эту проблему, затем снова сожмите и установите модуль. Этот шаг становится немного утомительным, когда у вас множество проблем. Вот где строить инструменты становится полезным.

## Phing

Phing — это инструмент командной строки, доступный для всех платформ, который используется для создания программных пакетов с использованием инструкций, хранящихся в xml-файле, по умолчанию именуемом build.xml. Для работы с кодом расширений его можно использовать для выполнения двух задач:

- копирование измененных файлов из вашей папки с исходниками расширения в соответствующие места в папке вашего веб-сайта.
- создание нового zip-файла для новых установок.

Скачайте и установите Phing. Доступны и другие инструменты сборки! Вы можете установить Phing в свою собственную папку bin или в системную папку bin. Вам нужно запомнить путь к вашему коду Phing. В этом примере это *~/bin/phing-latest.phar*. Вы можете попробовать его из командной строки, перейдя в папку, содержащую код вашего расширения:
```sh
    cd ~/git/j4xdemos-mod-debugme
    php ~/bin/phing-latest.phar
```
Результат:
```sh
    Buildfile: /Users/ceford/git/j4xdemos-mod-debugme/build.xml

    mod_debugme > main:
          ... Здесь будут упомянуты все скопированные файлы
          [zip] Создание zip: /Users/ceford/zips/mod_debugme.zip

    СБОРКА ЗАВЕРШЕНА

    Общее время: 0.0863 секунды
```

## Задачи в VS Code

Чтобы запустить Phing внутри VS Code, вам нужно создать файл *tasks.json* в папке *.vscode* в корневом каталоге папки *j4xdemos-mod-debugme*. Если она не существует, сначала создайте её. Затем создайте файл *tasks.json* и введите следующий код:
```json
    {
        // См. https://go.microsoft.com/fwlink/?LinkId=733558
        // для получения документации о формате tasks.json
        "version": "2.0.0",
        "tasks": [
          {
            "label": "Сборка mod_debugme",
            "type": "shell",
            "command": "php ~/bin/phing-latest.phar",
            "windows": {
              "command": "php ~/bin/phing-latest.phar"
            },
            "group": "build",
            "presentation": {
              "reveal": "always",
              "panel": "shared"
            }
          }
        ]
    }
```
Пользователям Windows необходимо исправить команду, специфичную для Windows. Теперь вы можете собрать расширение, используя меню *Terminal / Run Build Task*. Результат выполнения команды должен появиться в панели Терминала под областью редактирования.
```sh
      *  Выполнение задачи: php ~/bin/phing-latest.phar

    Buildfile: /Users/ceford/git/gitdemo/j4xdemos-mod-debugme/build.xml

    mod_debugme > main:

          [zip] Нечего делать: /Users/ceford/zips/mod_debugme.zip актуален.

    СБОРКА ЗАВЕРШЕНА

    Общее время: 0.1031 секунд

     *  Терминал будет повторно использоваться задачами, нажмите любую клавишу для его закрытия.
```
Могут возникнуть непонятные сообщения об ошибках. Наиболее вероятная причина - это наличие недопустимых путей к папкам в файле *build.xml* или папка еще не была создана. Еще одна проблема для отладки!

## Отладка

Вы должны быть в состоянии исправить первую ошибку путем просмотра кода. Более сложные проблемы требуют пошагового выполнения кода с помощью отладчика. Это позволяет вам проверять переменные, чтобы увидеть, содержат ли они ожидаемые значения, например, при передаче аргументов в функции из библиотеки.

### Настройки *php.ini*

Чтобы настроить отладку с Xdebug, необходимо добавить несколько записей в начало вашего файла *php.ini*.
```ini
    zend_extension="xdebug.so"
    xdebug.mode="debug"
    xdebug.client_port=9003
    xdebug.start_with_request = yes
```
После сохранения изменений перезапустите сервер Apache.

### Добавление окна для сайта

В вашей папке расширений содержится всего несколько файлов, это ***исходники*** файлов, установленных на вашем сайте. Отладка во время работы включает в себя установку точек останова в файлах вашего ***сайта***, поэтому вам нужен доступ к этим файлам. Вы можете использовать меню *File / Add Folder to Workspace...* для добавления папки сайта в ваше рабочее пространство. Однако, велика вероятность, что вы случайно измените файлы сайта вместо исходных файлов. Поэтому, возможно, лучше открыть отдельное окно VS Code для отладки.

- **Открыть новое окно:** В меню VS Code выберите *File / New Window* и выберите папку, содержащую ваш сайт Joomla.
- **Открыть папку:** В новом окне выберите *File / Open Folder...* в меню VS Code. Найдите папку вашего сайта и выберите ее. В основной боковой панели вы должны увидеть список всех файлов вашего сайта Joomla.

### Конфигурация запуска

Для того чтобы отладка работала в VS Code, необходима конфигурация запуска. В корневой директории вашего сайта создайте папку с именем *.vscode* (заметьте точку в начале) с файлом *launch.json* следующего содержания:
```json
    {
        "configurations": [
            {
                "name": "Listen for XDebug",
                "type": "php",
                "request": "launch",
                "hostname": "0.0.0.0",
                "port": 9003,
                "stopOnEntry": true,
                "pathMappings": {
                    "/Users/ceford/Sites/j421rc2": "${workspaceFolder}"
                }
            }
        ]
    }
```
Не забудьте заменить элемент pathMappings в этом примере на фактический pathMappings для вашего сайта. Элемент stopOnEntry приостановит выполнение на самой первой строке PHP-кода.

### Отладка *mod_debugme*

Теперь вы готовы найти и исправить ошибки в установленном модуле.

- **Найти код модуля:** Найдите первую ошибку на строке 16 в файле JROOT/modules/mod_debugme/mod_debugme.php.
- **Установить точку останова:** Щелкните в пространстве слева от номера 16. Бледно-красный кружок появится при наведении и станет полностью красным после клика, указывая, что точка останова установлена.
- **Начать отладку:** В меню VS Code выберите *Run / Start Debugging*. В браузере перезагрузите сайт. Окно VS Code должно вновь появиться с кодом, остановленным на первой строке файла *index.php* вашего сайта. В верхней части экрана находятся несколько иконок для управления процессом отладки. Они должны быть понятны сами по себе. Если нет, найдите информацию о них в разделе Help / Documentation VS Code.
- **Продолжить:** Выберите кнопку продолжения — код выполнится до первой точки останова. Изучите код, чтобы понять, в чем проблема.
- **Наведение:** При наведении на переменную, которой было присвоено значение, появится небольшая подсказка, суммирующая атрибуты этой переменной. Для переменных, которым не присвоены значения, подсказка не появляется.
- **Переменные:** Левая колонка содержит больше информации о состоянии кода в точке останова. Слишком много возможностей, чтобы охватить их здесь. Изучайте по мере необходимости!
- **Остановить отладку:** Вероятно, лучше выбрать иконку продолжения, иначе веб-страница останется пустой. В противном случае можно использовать кнопку остановки или меню Run / Stop Debugging.

### Исправление ошибки

**Помните:** Не исправляйте ошибку в коде сайта! Исправляйте ее в исходном коде!

Исправьте исходный код, затем используйте *Terminal / Run Build Task...*.

Перезапустите отладку.

### Советы

Несколько неочевидных проблем:

- Вы исправили первую ошибку, но она все еще вызывает сбой на этой строке. Посмотрите в модуле mod_debugme.xml, где определен src для именованных пространств классов. После исправления в исходниках необходимо переустановить zip файл или удалить *administrator/cache/autoload_psr4.php*. Если он отсутствует, Joomla перестраивает этот файл из файлов манифестов. Но если в нем есть некорректная или отсутствующая запись, это не будет исправлено до переустановки расширения.
- Иногда необходимо установить точку останова за несколько строк до строки с ошибкой, особенно если вы хотите проверить значения, передаваемые в вызовы функций.
- Таблица *xxx.yyy\\debugme* не существует. Ах да, код для создания таблицы при установке и удаления при деинсталляции никогда не создавался. Вам нужно будет выполнить SQL-запрос в phpMyAdmin, используя содержимое файла *mod\\debugme.sql*. Не забудьте изменить *\#\\* в именах таблиц на префикс вашей базы данных. И если это все еще не работает, проверьте имя таблицы в коде.

## Скриншот

Когда все исправлено, вы можете увидеть следующее:

![vscode debugged module site view](../../../en/images/test-installations/vscode-primer-debugme-fixed.png)

Дни пирога?

## Литература

Из документации Joomla!: [Visual Studio Code](https://docs.joomla.org/Visual_Studio_Code) также охватывает настройку других инструментов, например CodeSniffer и PHPUnit.

*Переведено с помощью openai.com*

